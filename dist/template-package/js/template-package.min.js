"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function deepCopy(t,e,i){if(null===t||"object"!==("undefined"==typeof t?"undefined":_typeof(t)))return t;if("function"==typeof t.clone)return t.clone(!0);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);void 0===e&&(e=[],i=[]);var r,n=e.length;for(r=0;r<n;r++)if(t===e[r])return i[r];if("[object Array]"==Object.prototype.toString.call(t)){var a=t.slice();for(e.push(t),i.push(a),r=a.length;r--;)a[r]=deepCopy(a[r],e,i);return a}var s=Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__;s||(s=t.constructor.prototype);var o=object_create(s);e.push(t),i.push(o);for(var u in t)o[u]=deepCopy(t[u],e,i);return o}var _get2=function t(e,i,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){t.extendext=function(){var e,i,r,n,a,s,o=arguments[0]||{},u=1,l=arguments.length,c=!1,h="default";for("boolean"==typeof o&&(c=o,o=arguments[u++]||{}),"string"==typeof o&&(h=o.toLowerCase(),"concat"!==h&&"replace"!==h&&"extend"!==h&&(h="default"),o=arguments[u++]||{}),"object"===("undefined"==typeof o?"undefined":_typeof(o))||t.isFunction(o)||(o={}),u===l&&(o=this,u--);u<l;u++)if(null!==(e=arguments[u]))if(t.isArray(e)&&"default"!==h)switch(s=o&&t.isArray(o)?o:[],h){case"concat":o=s.concat(t.extend(c,[],e));break;case"replace":o=t.extend(c,[],e);break;case"extend":e.forEach(function(e,i){if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var r=t.isArray(e)?[]:{};s[i]=t.extendext(c,h,s[i]||r,e)}else s.indexOf(e)===-1&&s.push(e)}),o=s}else for(i in e)r=o[i],n=e[i],o!==n&&(c&&n&&(t.isPlainObject(n)||(a=t.isArray(n)))?(a?(a=!1,s=r&&t.isArray(r)?r:[]):s=r&&t.isPlainObject(r)?r:{},o[i]=t.extendext(c,h,s,n)):void 0!==n&&(o[i]=n));return o}}(jQuery);var Util=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"each",value:function(t,e){for(var i in t){var r=t[i];e(i,r)}}}]),t}();"undefined"==typeof isDefined&&(window.isDefined=function(t){return"undefined"!=typeof t}),"undefined"==typeof isNull&&(window.isNull=function(t){return null===t}),"undefined"==typeof isNullOrUndefined&&(window.isNullOrUndefined=function(t){return null===t||"undefined"===t}),"undefined"==typeof isFunction&&(window.isFunction=function(t){return"function"==typeof t}),"undefined"==typeof isString&&(window.isString=function(t){return"string"==typeof t}),"undefined"==typeof isNumber&&(window.isNumber=function(t){return"number"==typeof t}),"undefined"==typeof isObject&&(window.isObject=function(t){return null!==t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))}),"undefined"==typeof isArray&&(window.isArray=function(t){return null!==t&&Array.isArray(t)}),"undefined"==typeof getType&&(window.getType=function(t){return null===t?"[object Null]":Object.prototype.toString.call(t)}),"undefined"==typeof createGuid&&(window.createGuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}),"undefined"==typeof Array.diff&&(Array.diff=function(t,e){return t.filter(function(t){return e.indexOf(t)<0})}),"undefined"==typeof Array.min&&(Array.min=function(t){return Math.min.apply(Math,t)}),"undefined"==typeof Array.max&&(Array.max=function(t){return Math.max.apply(Math,t)}),"undefined"==typeof Object.set&&(Object.set=function(t,e){for(var i in e)t.hasOwnProperty(i)&&(t[i]=e[i])}),"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t});var object_create=Object.create;if("function"!=typeof object_create&&(object_create=function(t){function e(){}return e.prototype=t,new e}),!isDefined($))throw new ReferenceError("util-jquery requires jquery 2.2.2 or greater");"undefined"==typeof isJquery&&(window.isJquery=function(t){return t instanceof $}),function(t){t.fn.hasAttr=function(e){return t(this).is("["+e+"]")},t.fn.populate=function(e){function i(t,e,i){switch(t){case"input":n(e,i);break;case"select":case"textarea":s.val(i);break;case"img":s.attr("src",i);break;case"button":s.prop("disabled",0===i);break;default:s.html(i)}}function r(t){return $Util.populate[t]?$Util.populate[t]:s.hasAttr("data-tag")?$Util.populate[s.attr("data-tag")]:null}function n(t,e){switch(t){case"checkbox":var i=s.data("checked");e.toString()!==i&&"1"!==e.toString()&&e!==!0||s.prop("checked",!0);break;case"radio":var r=e.toString();s.filter('[value="'+r+'"]').prop("checked",!0);break;default:s.val(e)}}var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t(this);if(s.data("populate")===!1)return this;var o=s.prop("tagName").toLowerCase(),u=s.attr("type"),l=r(o);return l?l.call(this,e):i(o,u,e),s.data("update")===!1&&this.attr("data-populate",!1),a&&s.trigger("change").trigger("input"),this},t.fn.populateChildren=function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t(this);return t.each(e,function(t,e){var n=r.find('[name="'+t+'"]'),a=r.find('[data-name="'+t+'"]');n.length>0&&n.data("populate")!==!1&&n.populate(e,i),a.length>0&&a.data("populate")!==!1&&a.populate(e,i)}),this},t.fn.populateAttr=function(e){var i=t(this);return t.each(e,function(t,e){i.attr("i",e)}),this},t.fn.slideToggleState=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e?t(this).slideDown(i,r):t(this).slideUp(i,r),this},t.fn.addToSelect=function(){var e={};arguments.length>1?e[arguments[0]]=arguments[1]:e=arguments[0];var i=t(this);return i.is("select")&&Util.each(e,function(t,e){var r='<option value="'+t+'">'+e+"</option>";i.append(r)}),this},t.fn.toggleOption=function(){var e=t(this);if(!e.is("select"))return this;var i,r;if(arguments.length>1){r=arguments[0],t.isArray(r)||(r=[r]),i=arguments[1];for(var n=0;n<r.length;n++)e.find('option[value="'+r[n]+'"]').prop("disabled",!i)}else i=arguments[0],e.find("option").prop("disabled",!i);return this}}(jQuery);var $Util=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"jQuerify",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.$wrapper)throw new ReferenceError("$Util.jQuerify: $wrapper must be a property of the first argument");Util.each(t.jqueryPrototype,function(t,r){return!(!isDefined(e[r])||i)||void(e[r]=function(){var t;return(t=e.$wrapper)[r].apply(t,arguments),e})})}},{key:"opts",value:function(t,e,i){return isDefined(i)?$.extendext(!0,i,t,e):$.extend(!0,t,e)}}]),t}();$Util.jqueryPrototype=Object.getOwnPropertyNames($.prototype),$Util.populate={};var EventSystem=function(){function t(){return _classCallCheck(this,t),this.events={},this}return _createClass(t,[{key:"_createEvent",value:function(t){return this.events[t]={callbacks:[]}}},{key:"_destroy",value:function(t){return isDefined(this.event[t])&&delete this.event[t],this}},{key:"on",value:function(t,e){var i=this.events[t];return isDefined(i)||(i=this._createEvent(t)),i.callbacks.push(e),this}},{key:"off",value:function(t,e){var i=this.events[t];if(isDefined(i)){var r=i.callbacks.indexOf(e);r>-1&&i.callbacks.splice(r,1)}return this}},{key:"offAll",value:function(t){var e=this.events[t];return isDefined(e)&&(e[t].callbacks=[]),this}},{key:"trigger",value:function(){var t=[].shift,e=t.apply(arguments),i=this.events[e];if(!isDefined(i))return this;for(var r=0;r<i.callbacks.length;r++){var n;(n=i.callbacks)[r].apply(n,arguments)}return this}},{key:"emit",value:function(){return this.trigger()}}]),t}();if(!isDefined(EventSystem))throw new ReferenceError("Manager requires EventSystem");var Manager=function(t){function e(t){var i;_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n={identifier:"id",useObjectNames:!1,max:0};return r.settings=Object.assign(n,t),r.objects={},r.count=0,r._cachedData={},r._processedData={},r.serializedObjects=[],r.requiresNewSerialize=!1,i=r,_possibleConstructorReturn(r,i)}return _inherits(e,t),_createClass(e,[{key:"_exists",value:function(){var t=arguments[0];return isString(t)||isNumber(t)?isDefined(this.objects[t]):isDefined(this.objects[t[this.settings.identifier]])}},{key:"_get",value:function(){var t=arguments[0],e=null,i=this.settings.identifier;return isString(t)||isNumber(t)?(String(t),this.objects[t]&&(e=this.objects[t])):this.objects[t[i]]&&(e=this.objects[t[i]]),e}},{key:"_add",value:function(t,e){function i(){r.requiresNewSerialize=!0,r.trigger("add",t),r.count++,t._count=r.count}var r=this,n=this.settings.identifier;return isDefined(e)?(String(e),t[n]=e,this.objects[e]=t,i()):isNullOrUndefined(t[n])?console.warn("Manager._add: cannot add an object with no identifier"):(this.objects[t[n]]=t,i()),t}},{key:"_update",value:function(t,e){function i(){r.requiresNewSerialize=!0,r.trigger("update",t),r.count++,t._count=r.count}var r=this,n=this.settings.identifier;return isDefined(e)?(String(e),this.objects[e]=t,i()):isNullOrUndefined(t[n])?console.warn("Manager._update: cannot update an object with no identifier"):(this.objects[t[n]]=t,i()),t}},{key:"_delete",value:function(){var t=(arguments[0],null),e=this.settings.identifier;if(t=this._get.apply(this,arguments)){var i=t[e];this.trigger("delete",i),delete this.objects[i],this.requiresNewSerialize=!0,this.count>0&&this.count--}else console.error("Manager._delete: cannot delete an object with no identifier");return this}},{key:"_empty",value:function(){for(var t in this.objects)delete this.objects[t];return this}},{key:"_cacheData",value:function(t){return this._cachedData=deepCopy(t),this}},{key:"_processData",value:function(t){return this._processedData=deepCopy(t),this}},{key:"getIds",value:function(){var t=[];for(var e in this.objects){var i=this.getId(this.objects[e]);t.push(i)}return t}},{key:"getId",value:function(t){return t[this.settings.identifier].toString()}},{key:"manage",value:function(t){if(this._cacheData(t),this._processData(t),!isObject(this._processedData)&&this.settings.useObjectNames)throw new Error("Manager.manage: to use option useObjectNames, object passed to manage() must be an object.");var e=this,i=this.settings.identifier,r=[];for(var n in this._processedData){var a=this._processedData[n];if(this.settings.useObjectNames&&(a[i]=n),!isDefined(a[i]))return console.error("Manager.manage: cannot manage objects with no ids");var s=a[i].toString(),o=e.objects[s];isDefined(o)?e._update(a):e._add(a),r.push(s)}var u=this.getIds(),l=Array.diff(u,r);for(n=0;n<l.length;n++)this._delete(l[n]);return this}},{key:"exists",value:function(){return this._exists.apply(this,arguments)}},{key:"addObjects",value:function(){var t=arguments.length>1?[].slice.call(arguments).sort():arguments[0];for(var e in t){var i=t[e];this.addObject(i)}return this}},{key:"addObject",value:function(){return this._add.apply(this,arguments)}},{key:"getObject",value:function(){return this._get.apply(this,arguments)}},{key:"updateObject",value:function(){return this._update.apply(this,arguments)}},{key:"deleteObject",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteObjects",value:function(){return this._empty()}},{key:"serializer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.requiresNewSerialize){var i=this;this.serializedObjects=[],$.each(this.objects,function(t,e){e.serializer&&i.serializedObjects.push(e.serializer())}),this.requiresNewSerialize=!1}return e=e>0?e:this.serializedObjects.length,this.serializedObjects.slice(t,e)}}]),e}(EventSystem),Template=function(){function t(e){_classCallCheck(this,t);var i={template:null,consumeTemplate:!1,useTemplate:!1,struct:{$wrapper:""}};return this.settings=$Util.opts(i,e),this._template(),this._cachedData={},this._processedData={},this}return _createClass(t,[{key:"_template",value:function(){return this.settings.template?this._useTemplate():this._useDefaultTemplate(),this.$wrapper.removeClass("template"),$Util.jQuerify(this),this}},{key:"_useTemplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t=t||this.settings.template,isString(t))t=$(t);else if(t instanceof $)this.settings.useTemplate||(t=t.clone().removeAttr("id")),this.settings.consumeTemplate&&t.remove();else if(t instanceof $==!1)throw new ReferenceError("Template._useTemplate: first argument must be a string or jquery");var e=this;for(var i in this.settings.struct){var r=this.settings.struct[i];e[i]=t.find(r)}return this.$wrapper=$(t.get(0)),this}},{key:"_useDefaultTemplate",value:function(){return this}},{key:"_cacheData",value:function(t){return this._cachedData=$.extend(!0,{},t),this}},{key:"_processData",value:function(t){return this._processedData=$.extend(!0,{},t),this}},{key:"populateChildren",value:function(t){return this._cacheData(t),this._processData(t),this.$wrapper.populateChildren(this._processedData),this}}]),t}(),TemplateManager=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return r.$wrapper=i.$wrapper?i.$wrapper:$('<div class="manager"></div>'),$Util.jQuerify(r),r.template=isString(i.template)?$(i.template):i.template,r.templates=r.objects,r.current=null,t=r,_possibleConstructorReturn(r,t)}return _inherits(e,t),_createClass(e,[{key:"_add",value:function(){var t=_get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_add",this).apply(this,arguments);return this.$wrapper.append(arguments[0].$wrapper||arguments[0]),t}},{key:"_update",value:function(t){var e=this.getId(t),i=this.templates[e];return this._populateTemplate(i,t),this.trigger("update",i),this}},{key:"_delete",value:function(){var t=this._get.apply(this,arguments);return t?(t.remove(),_get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_delete",this).call(this,t)):console.error("TemplateManager._delete: could not find template object"),this}},{key:"_create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.template)throw new ReferenceError("TemplateManager._create: no template option was passed to constructor");var i;return this.template.prototype instanceof Template?i=new this.template(e):isJquery(this.template)&&(i=this.template.clone()),this._populateTemplate(i,e),this._add(i,t)}},{key:"_empty",value:function(){for(var t in this.objects)this.objects[t].remove(),delete this.objects[t];return this}},{key:"_populateTemplate",value:function(t,e){return t.populateChildren(e),this}},{key:"manage",value:function(t){return this.build(t)}},{key:"build",value:function(t){if(this._cacheData(t),this._processData(t),!isObject(this._processedData)&&this.settings.useObjectNames)throw new Error("TemplateManager.build: to use option useObjectNames, object passed to build() must be an object.");var e=this,i=this.settings.identifier,r=[];for(var n in this._processedData){var a=this._processedData[n];if(this.settings.useObjectNames&&(a[i]=n),!isDefined(a[i]))return console.error("TemplateManager.build: cannot manage objects with no ids");var s=a[i].toString(),o=e.objects[s];isDefined(o)?e._update(a):e._create(s,a),r.push(s)}var u=this.getIds(),l=Array.diff(u,r);for(n=0;n<l.length;n++)this._delete(l[n]);return this}},{key:"setCurrent",value:function(t){function e(){r.slideDown()}var i=this,r=this.templates[t];return isDefined(r)?isNull(this.current)?(e(),this.current=r):this.current.slideUp(function(){e(),i.current=r}):console.error("TemplateManager.setCurrent: object not found."),this}},{key:"createTemplate",value:function(){return this._create.apply(this,arguments)}},{key:"addTemplates",value:function(){return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"addObjects",this).apply(this,arguments)}},{key:"addTemplate",value:function(){return this._add.apply(this,arguments)}},{key:"getTemplate",value:function(){return this._get.apply(this,arguments)}},{key:"updateTemplate",value:function(){return this._update.apply(this,arguments)}},{key:"deleteTemplate",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteTemplates",value:function(){return this._empty()}}]),e}(Manager),Feedback=function(t){function e(t){var i;_classCallCheck(this,e);var r={closeButton:!0,struct:{$wrapper:".feedback",$text:".feedback-text",$icon:".feedback-icon",$close:'button[name="close"]'}},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t))),a=n;return n.settings.closeButton&&n.$close.click(function(){a.slideUp()}),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_useDefaultTemplate",value:function(){var t='<div class="feedback"><span class="feedback-icon"></span><span class="feedback-text"></span>';return this.settings.closeButton&&(t+='<button name="close" type="button">X</button>'),t+="</div>",this._useTemplate($(t)),this.$wrapper.hide(),this}},{key:"_setClass",value:function(t){return this.removeClass(function(t,e){return(e.match(/(^|\s)feedback-\S+/g)||[]).join(" ")}),"feedback-".indexOf(t)===-1&&(t="feedback-"+t),this.addClass(t),this}},{key:"_animateFeedback",value:function(t,e,i){return this._setClass(t),this.$text.fadeOut(function(){$(this).html(e).fadeIn()}),i&&this.$icon.fadeOut(function(){$(this).html(i).fadeIn()}),this}},{key:"setFeedback",value:function(t,e,i){return this.is(":hidden")?(this._setClass(t),this.$text.html(e),i&&this.$icon.html(i),this.slideDown()):this._animateFeedback(t,e,i),this}}]),e}(Template),CrudRow=function(t){function e(t){var i;_classCallCheck(this,e);var r={struct:{$wrapper:"tr",$deleteButton:'[name="deleteButton"]',$updateButton:'[name="updateButton"]',$viewButton:'[name="viewButton"]'}},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_attachDeleteButtonHandlers",value:function(){var t=this;return this.$deleteButton.click(function(){t._deleteButtonAction()}),this}},{key:"_deleteButtonAction",value:function(){throw new Error("CrudRow._deleteButtonAction: must be implemented in child class")}},{key:"_attachUpdateButtonHandlers",value:function(){var t=this;return this.$updateButton.click(function(){t._updateButtonAction()}),this}},{key:"_updateButtonAction",value:function(){throw new Error("CrudRow._updateButtonAction: must be implemented in child class")}},{key:"_attachViewButtonHandlers",value:function(){var t=this;return this.$viewButton.click(function(){t._viewButtonAction()}),this}},{key:"_viewButtonAction",value:function(){throw new Error("CrudRow._viewButtonAction: must be implemented in child class")}},{key:"initialize",value:function(){return this._attachDeleteButtonHandlers()._attachUpdateButtonHandlers()._attachViewButtonHandlers(),this}}]),e}(Template),Table=function(t){function e(t){var i;_classCallCheck(this,e);var r={struct:{$wrapper:"table",$thead:"thead",$tbody:"tbody",$tfoot:"tfoot",$tr:"tbody > tr"},rowHeaders:[]},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return n.$rows=[],n.isFirstBuild=!0,n.$empty=$('<tr class="table-empty"><td>There is no data to display.</td></tr>'),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_useTemplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_useTemplate",this).call(this,t),this.$tr.remove(),this}},{key:"_useDefaultTemplate",value:function(){var t='<table class="table"><thead></thead><tbody><tr></tr></tbody><tfoot></tfoot></table>';this._useTemplate($(t)),this.settings.template=null;for(var e=this.settings.rowHeaders,i=$("<tr></tr>"),r=0;r<e.length;r++){var n=e[r]||"",a="<th>"+n+"</th>",s="<td></td>";this.$tr.append(s),i.append(a)}return this.$thead.append(i),this}},{key:"_cacheData",value:function(t){return isArray(t)?this._cachedData=t:this._cachedData=$.extend(!0,{},t),this}},{key:"_processData",value:function(t){var e=this;return isArray(t)?this._processedData=t:this._processedData=$.extend(!0,{},t),$.each(t,function(t,i){isObject(i)&&(e._processedData[t]._id=t),e._processedData[t]=e._processRow(i)}),this}},{key:"_processRow",value:function(t){return t}},{key:"_render",value:function(t){function e(){return n.$tr.clone()}function i(t){t.appendTo(n.$tbody),n.$rows.push(t)}function r(t,e){var i=[];Util.each(e,function(t,e){i.push(e)});var r=t.find("td");$.each(r,function(t,e){$(e).html(i[t])})}var n=this,a=!isNull(this.settings.template),s=Array.isArray(t);return this.wipe(),!$.isEmptyObject(t)||s&&t.length?(this.toggleEmpty(!1),Util.each(t,function(t,n){var s=e();a&&!Array.isArray(n)?s.populateChildren(n):r(s,n),i(s)}),this):this}},{key:"_isEmptyTable",value:function(){return 0===this.$tbody.find("tr").length}},{key:"build",value:function(t){return this._cacheData(t),this._processData(t),this.toggleEmpty(!1),this._render(this._processedData),this.isFirstBuild=!1,this}},{key:"wipe",value:function(){return this.$tbody.empty(),this.toggleEmpty(!0),this.$rows=[],this._cachedData={},this}},{key:"deleteRow",value:function(t){return this.$rows[t]&&(this.$rows[t].remove(),this.$rows.splice(t,1)),this._isEmptyTable()&&this.toggleEmpty(),this}},{key:"toggleEmpty",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$thead.toggle(!t),this.$tfoot.toggle(!t),t?(this.$tbody.append(this.$empty),this.$empty.show()):this.$empty.remove(),this}}]),e}(Template),RenderTable=function(t){function e(t){var i;_classCallCheck(this,e);var r={identifier:"id",useObjectNames:!1,rowTemplate:null},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return n.rowManager=new TemplateManager({identifier:n.settings.identifier,useObjectNames:n.settings.useObjectNames,template:n.settings.rowTemplate||n.$tr,$wrapper:n.$tbody}),n.$wrapper.addClass("renderTable"),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_render",value:function(t){var e=Array.isArray(t);if($.isEmptyObject(t)||!t||e&&!t.length)this.toggleEmpty(!0);else if(e&&!isObject(t[0]))throw new ReferenceError("RenderTable._render: data must be an object, or an array of objects");return this.rowManager.build(t),this}},{key:"wipe",value:function(){return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"wipe",this).call(this),this.rowManager.deleteObjects(),this}},{key:"deleteRow",value:function(){var t;return(t=this.rowManager).deleteObject.apply(t,arguments),this._isEmptyTable()&&this.toggleEmpty(),this}}]),e}(Table),ControlTable=function(t){function e(t){var i;_classCallCheck(this,e);var r={buttons:{deleteButton:!0,viewButton:!0,updateButton:!0}},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return n._setupButtons(),n.$wrapper.addClass("controlTable"),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_setupButtons",value:function(){function t(t){var e=r.$tr.find('[data-name="'+t+'"]'),i=r.$tr.find('[name="'+t+'"]');return e.length||i.length}function e(){r.$thead.find("tr").append("<th></th>")}function i(t){r.$tr.append('<td data-name="'+t+'"></td>')}var r=this;$.each(this.settings.buttons,function(r,n){n&&!t(r)&&(e(),i(r))})}},{key:"_processRow",value:function(t){return this.settings.buttons.deleteButton&&this._addDeleteButton(t),this.settings.buttons.updateButton&&this._addUpdateButton(t),this.settings.buttons.viewButton&&this._addViewButton(t),t}},{key:"_addDeleteButton",value:function(t){return t.deleteButton=this._createDeleteButton(t),this}},{key:"_createDeleteButton",value:function(t){var e=this,i=$('<button type="button" title="Delete">Delete</button>');return i.click(function(){e.deleteRow(t)}),i}},{key:"_addUpdateButton",value:function(t){return t.updateButton=this._createUpdateButton(t),this}},{key:"_createUpdateButton",value:function(t){return $('<button type="button" title="Update">Update</button>')}},{key:"_addViewButton",value:function(t){return t.viewButton=this._createViewButton(t),this}},{key:"_createViewButton",value:function(t){return $('<button type="button" title="View">View</button>')}}]),e}(RenderTable),Form=function(t){function e(t){var i;_classCallCheck(this,e);var r={feedback:!0,useTemplate:!0,submitUrl:"",submitRequest:null,serializeMode:FormSerializer.serializeMode.toString,checkboxMode:FormSerializer.checkboxMode.number,excluded:[":disabled"],struct:{$wrapper:"form",$feedback:".form-feedback",$header:".form-header",$body:".form-body",$footer:".form-footer",$cancel:".form-cancel",$reset:".form-reset",$submit:'button[type="submit"]'},validator:null},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t,"replace"))),a=n;n._serializedData={};var s=n.$wrapper.find("form");return n.$form=s.length>0?s:n.$wrapper,n.formSerializer=new FormSerializer({serializeMode:n.settings.serializeMode,checkboxMode:n.settings.checkboxMode,excluded:n.settings.excluded}),n.validator=null,n.feedback=null,n.$form.on("submit",function(t){t.preventDefault(),a.serializeForm()._submit()}),n.$cancel.click(function(){a.resetForm()}),n.$reset.click(function(){a.resetForm()}),n.settings.validator&&n._setupValidator(),n.settings.feedback&&n._setupFeedback(),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_useDefaultTemplate",value:function(){var t='<form class="form"><div class="form-feedback"></div><div class="form-header"></div><div class="form-body"></div><div class="form-footer"><button type="submit" class="form-submit">Submit</button><button type="button" class="form-reset">Reset</button><button type="button" class="form-cancel">Cancel</button></div></form>';return this._useTemplate($(t)),this}},{key:"_setupValidator",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":e.validators.formValidation.setup(this,this.$form,t.options)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$form.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_prepare",value:function(){return this.toggleForm(!1),this.feedback.show(),this.feedback.setFeedback("processing","Getting data..."),this}},{key:"_ready",value:function(){return this.feedback.slideUp(),this.slideToggleForm(!0),this}},{key:"_submit",value:function(){var t=this;return this.trigger("beforeSubmit",this),this.feedback&&this.feedback.setFeedback("processing","Processing..."),this._doSubmit().done(function(e){t._done(e)}).fail(function(e){t._fail(e)}).always(function(){t._always()})}},{key:"_doSubmit",value:function(){var t=this.settings;return t.submitRequest?t.submitRequest(this._serializedData):$.post(t.submitUrl,this._serializedData)}},{key:"_done",value:function(t){return this.feedback&&this.feedback.setFeedback("success"," Operation was successful"),this.trigger("done",t),this}},{key:"_fail",value:function(t){return this.feedback&&this.feedback.setFeedback("danger","Operation has failed"),this.trigger("fail",t),this}},{key:"_always",value:function(){return this.toggleButtons(!0),this.trigger("always"),this}},{key:"_getFormData",value:function(){return $.Deferred().resolve().promise()}},{key:"toggleButtons",value:function(t){return this.$cancel.prop("disabled",!t),this.$reset.prop("disabled",!t),this.$submit.prop("disabled",!t).toggleClass("disabled",!t),this}},{key:"lockSubmit",value:function(t){function e(){if(n>=t)clearInterval(a);else{var e=Math.floor((t-n)/1e3);e=e||1;var s=r+" | "+e;i.$submit.html(s),n+=1e3}}var i=this,r=this.$submit.html();this.$submit.prop("disabled",!0),setTimeout(function(){i.$submit.prop("disabled",!1),i.$submit.html(r)},t);var n=0,a=setInterval(e,1e3);e()}},{key:"toggleForm",value:function(t){return this.$body.toggle(t),this.$footer.toggle(t),this}},{key:"slideToggleForm",value:function(t){return this.$body.slideToggleState(t),this.$footer.slideToggleState(t),this}},{key:"populateForm",value:function(t){return this._cacheData(t),this._processData(t),this.$form.populateChildren(this._processedData),this}},{key:"serializeForm",value:function(){return this._serializedData=this.formSerializer.serialize(this.$form),this}},{key:"resetForm",value:function(){if($.isEmptyObject(this._cachedData)?this.$form[0].reset():this.populateForm(this._cachedData),this.feedback&&this.feedback.slideUp(),this.toggleButtons(!0),this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm()}return this}},{key:"validate",value:function(){var t=!1;if(this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm(),this.validator.validateContainer(this.$form),t=this.validator.isValidContainer(this.$form)}return t}},{key:"clean",value:function(){return this._cachedData={},this.resetForm(),this.toggleForm(!0),this}},{key:"initialize",value:function(){return this.clean(),this}}]),e}(Template);Form.validators={formValidation:{api:"formValidation",options:{framework:"bootstrap",excluded:[":disabled",":hidden",":not(:visible)"],icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}},setup:function(t,e,i){e.off("submit"),e.data("formValidation")&&e.data("formValidation").destroy(),e.formValidation(i).on("success.form.fv",function(e){e.preventDefault(),t.toggleButtons(!1),t.serializeForm()._submit()}),t.validator=e.data("formValidation")}}};var FormSerializer=function(){function t(e){_classCallCheck(this,t);var i={checkboxMode:t.checkboxMode.number,serializeMode:t.serializeMode.toString,excluded:[":disabled"]};return this.settings=$Util.opts(i,e,"replace"),this}return _createClass(t,[{key:"_getElName",value:function(t){return"undefined"!=typeof t.attr("name")?t.attr("name"):"undefined"!=typeof t.data("name")?t.data("name"):(console.error("FormSerializer._getElName: field has no name or data-name attribute"),"")}},{key:"_convertCheckbox",value:function(e,i){var r=e.is(":checked");switch(i){case t.checkboxMode["boolean"]:return r;case t.checkboxMode.number:return r?1:0;case t.checkboxMode.string:return r?"1":"0";case t.checkboxMode.onOff:return r?"on":"off"}}},{key:"serialize",value:function(e){var i=this,r=new FormSerializerData,n={};
switch(e.find("input, select").each(function(t,e){for(var r=$(e),a="",s=-1,o="",u="",l="",c=i.settings.excluded,h=0;h<c.length;h++)if(r.is(c[h]))return!0;if(r.data("serialize")===!1)return!0;if(u=r[0].nodeName.toLowerCase(),a=i._getElName(r),"undefined"==typeof a)return!0;if("undefined"!=typeof r.data("order")&&(s=r.data("order")),"input"===u){if(o=r.attr("type"),"undefined"==typeof o)return console.error("FormSerializer.serialize: input"+a+" must have a type");switch(o){case"checkbox":l=i._convertCheckbox(r,i.settings.checkboxMode);break;case"radio":if(!r.is(":checked"))return!0;l=r.val();break;case"file":var d=r.get(0).files;if(0===d.length)return!0;l=d[0];break;default:l=r.val()}}else"select"===u?l=r.val():console.error("FormSerializer.serialize: only inputs and selects can be serialized");n[a]={val:l,order:s}}),r.set(n),this.settings.serializeMode){default:case t.serializeMode.toString:return r.toString();case t.serializeMode.toOrderedString:return r.toOrderedString();case t.serializeMode.toObject:return r.toObject();case t.serializeMode.toValue:return r.toValue()}}}]),t}();FormSerializer.checkboxMode={"boolean":0,number:1,string:2,onOff:3},FormSerializer.serializeMode={toString:0,toOrderedString:1,toObject:2,toValue:3};var FormSerializerData=function(){function t(e){return _classCallCheck(this,t),this.data=e||{},this}return _createClass(t,[{key:"set",value:function(t){return this.data=t,this}},{key:"toString",value:function(){var t="",e=0,i=Object.keys(this.data).length;return Util.each(this.data,function(r,n){t+=r+"="+n.val,e++<i-1&&(t+="&")}),t}},{key:"toOrderedString",value:function(){var t="",e=[],i=[];Util.each(this.data,function(t,r){var n={name:t,val:r.val};r.order>-1?e[r.order]=n:i.push(n)});for(var r=e.length,n=0;n<r;n++)t+=e[n].name+"="+e[n].val,n<r&&(t+="&");for(r=i.length,n=0;n<r;n++)t+=i[n].name+"="+i[n].val,n<r-1&&(t+="&");return t}},{key:"toObject",value:function(){var t={};return Util.each(this.data,function(e,i){t[e]=""===i.val||isNaN(i.val)?t[e]=i.val:parseInt(i.val)}),t}},{key:"toValue",value:function(){var t=null;return Util.each(this.data,function(e,i){t=isNaN(i.val)?i.val:parseInt(i.val)}),t}}]),t}(),Wizard=function(t){function e(t){var i;_classCallCheck(this,e);var r={struct:{$wrapper:".wizard",$nav:"ul.nav",$navs:"ul.nav > li",$tabs:".tab-pane",$next:"li.next",$pager:"ul.pager",$previous:"li.previous"}},n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return n.stepCount=n.$tabs.length,n.step=0,n.toggleSubmitButton(1===n.stepCount),n.togglePreviousButton(!1),n.toggleNextButton(n.stepCount>1),n._setHandlers(),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,[{key:"_clearHandlers",value:function(){this.$next.off("click.wizard"),this.$previous.off("click.wizard"),this.$submit.off("click.wizard"),this.$navs.each(function(t,e){$(e).off("click.wizard")})}},{key:"_setHandlers",value:function(){var t=this;return this._clearHandlers(),this.$next.on("click.wizard",function(){t._getNextNav().find("a").click()}),this.$previous.on("click.wizard",function(){t.validateTab(t._getTab(t.step)),t._getPreviousNav().find("a").click()}),this.$submit.on("click.wizard",function(){t.validateAllTabs()}),this.$navs.each(function(e,i){$(i).on("click.wizard",function(){t._setPagination(e);var i=e;if(e>t.step)for(i-=1;i>=0;i--)t.validateTab(t._getTab(i));else if(e<t.step)for(i;i<t.step+1;i++)t.validateTab(t._getTab(i));t.step=e,t._toggleNavInvalid($(this),!1)})}),this}},{key:"_useDefaultTemplate",value:function(){return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_useDefaultTemplate",this).call(this),this.$form=this.$wrapper,this.$wrapper=$('<div class="wizard"></div>'),this.$nav=$('<ul class="nav"></ul>'),this.$tabs=$('<div class="tab-pane"></div>'),this.$pager=$('<ul class="pager"></ul>'),this.$next=$('<li class="next"><a href="#">Next</a></li>'),this.$previous=$('<li class="previous"><a href="#">Previous</a></li>'),this.$pager.append(this.$previous,this.$next,this.$submit),this.$footer.append(this.$pager),this.$form.append(this.$tabs,this.$footer),this.$wrapper.append(this.$nav,this.$form),this}},{key:"_setupValidator",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":var i=$.extend(!0,{},t.options);i.excluded=[":disabled"],e.validators.formValidation.setup(this,this.$form,i)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$wrapper.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_setPagination",value:function(t){switch(this.togglePreviousButton(!1),this.toggleNextButton(!1),this.toggleSubmitButton(!1),t){case 0:this.togglePreviousButton(!1),1===this.stepCount?this.toggleSubmitButton():this.stepCount>1&&this.toggleNextButton();break;case this.stepCount-1:this.toggleSubmitButton(),this.stepCount>1&&this.togglePreviousButton();break;default:this.stepCount>1&&(this.toggleNextButton(),this.togglePreviousButton())}}},{key:"_getNav",value:function(t){return $(this.$navs.get(t))}},{key:"_getNavFromTab",value:function(t){var e=this.$tabs.index(t);return this._getNav(e)}},{key:"_getPreviousNav",value:function(){return $(this.$navs.get(this.step-1))}},{key:"_getCurrentNav",value:function(){return $(this.$navs.get(this.step))}},{key:"_getNextNav",value:function(){return $(this.$navs.get(this.step+1))}},{key:"_toggleNavInvalid",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.toggleClass("wizard-tab invalid",e),this}},{key:"_getTab",value:function(t){return $(this.$tabs.get(t))}},{key:"_getCurrentTab",value:function(){return $(this.$tabs.get(this.step))}},{key:"_getNextTab",value:function(){return this.step!==this.stepCount?$(this.$tabs.get(this.step+1)):null}},{key:"_getPreviousTab",value:function(){return this.step>0?$(this.$tabs.get(this.step-1)):null}},{key:"validateTab",value:function(t){var e=this.settings.validator.api,i=!0;switch(e){case"formValidation":this.validator.validateContainer(t),i=this.validator.isValidContainer(t)}var r=this._getNavFromTab(t);return this._toggleNavInvalid(r,!i),i}},{key:"validateCurrentTab",value:function(){var t=this._getCurrentTab();return this.validateTab(t)}},{key:"validatePreviousTab",value:function(){var t=this._getPreviousTab();return this.validateTab(t)}},{key:"validateNextTab",value:function(){var t=this._getNextTab();return this.validateTab(t)}},{key:"validateAllTabs",value:function(){var t=this,e=!0;return $.each(this.$tabs,function(i,r){var n=$(r);t.validator.validateContainer(n);var a=t.validator.isValidContainer(n);t._toggleNavInvalid(t._getNav(i),!a),a||(e=!1)}),e}},{key:"toggleNextButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$next.toggle(t),this}},{key:"togglePreviousButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$previous.toggle(t),this}},{key:"toggleSubmitButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$submit.toggle(t),this}},{key:"toggleForm",value:function(t){return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toggleForm",this).call(this,t),this.$nav.toggle(t),this}},{key:"slideToggleForm",value:function(t){return _get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"slideToggleForm",this).call(this,t),this.$nav.slideToggleState(t),this}},{key:"resetNavValidation",value:function(){for(var t=0;t<this.$navs.length;t++){var e=$(this.$navs[t]);this._toggleNavInvalid(e,!1)}return this}},{key:"resetForm",value:function(){var t=$(this.$navs[0]);return t.find("a").click(),this.resetNavValidation(),_get2(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resetForm",this).call(this),this}}]),e}(Form);