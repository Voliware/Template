"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _get=function t(e,i,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,i,a)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(a)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),Form=function(t){function e(t){var i;_classCallCheck(this,e);var a={feedback:!0,submitUrl:"",struct:{$wrapper:"form",$header:".form-header",$body:".form-body",$footer:".form-footer",$cancel:".form-cancel",$submit:'button[type="submit"]'},validator:null},r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(a,t))),n=r;return r._serializedData={},r.$form=r.$wrapper,r.formSerializer=new FormSerializer,r.validator=null,r.feedback=null,r.$wrapper.on("submit",function(t){t.preventDefault(),n.serializer()._submit()}),r.settings.validator&&r._validatorFactory(),r.settings.feedback&&r._setupFeedback(),i=r,_possibleConstructorReturn(r,i)}return _inherits(e,t),_createClass(e,[{key:"_useDefaultTemplate",value:function(){var t='<form class="form"><div class="form-header"></div><div class="form-body"></div><div class="form-footer"><button type="submit" class="form-submit">Submit</button><button type="button" class="form-cancel">Cancel</button></div></form>';return this.settings.template=$(t),this.settings.useTemplate=!0,this._useTemplate(),this}},{key:"_validatorFactory",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":e.validators.formValidation.setup(this,t.options)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.feedback.$wrapper.prependTo(this.$body),this}},{key:"_submit",value:function(){var t=this,e=this.feedback;return this.serializer(),this.trigger("beforeSubmit"),e&&e.setFeedback("processing","Processing..."),this._doSubmit().done(function(){t._onSuccess()}).fail(function(){t._onSuccess()}).always(function(){t._onAlways()})}},{key:"_doSubmit",value:function(){return $.post(this.submitUrl,this._serializedData)}},{key:"_onSuccess",value:function(){var t=this.feedback;return this.trigger("submitSuccess"),t&&t.setFeedback("success"," Operation was successful"),this}},{key:"_onFail",value:function(){var t=this.feedback;return this.trigger("submitFail"),t&&t.setFeedback("danger","Operation has failed"),this}},{key:"_onAlways",value:function(){return this.trigger("submitComplete"),this}},{key:"populate",value:function(t){return this.$body.populateChildren(t),this}},{key:"serializer",value:function(){return this._serializedData=this.formSerializer.serialize(this.$wrapper),this}}]),e}(Template);Form.validators={formValidation:{api:"formValidation",options:{framework:"bootstrap",excluded:[":disabled",":hidden",":not(:visible)"],icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}},setup:function(t,e){t.$wrapper.off("submit"),t.$wrapper.formValidation(e).on("success.form.fv",function(e){e.preventDefault(),t.serializer()._submit()}),t.validator=t.$wrapper.data("formValidation")}}};var FormSerializer=function(){function t(e){_classCallCheck(this,t);var i={checkboxMode:t.checkboxMode.number};return this.settings=$Util.opts(i,e),this}return _createClass(t,[{key:"_getElName",value:function(t){return"undefined"!=typeof t.attr("name")?t.attr("name"):"undefined"!=typeof t.data("name")?t.data("name"):(console.error("FormSerializer._getElName: field has no name or data-name attribute"),"")}},{key:"_convertCheckbox",value:function(e,i){var a=e.is(":checked");switch(i){case t.checkboxMode["boolean"]:return a;case t.checkboxMode.number:return a?1:0;case t.checkboxMode.string:return a?"1":"0";case t.checkboxMode.onOff:return a?"on":"off"}}},{key:"serialize",value:function(t){var e=this,i=new FormSerializerData,a={};return t.find("input, select").each(function(t,i){var r=$(i),n="",o=-1,s="",u="",l="";if(r.data("serialize")===!1)return!0;if(u=r[0].nodeName.toLowerCase(),n=e._getElName(r),"undefined"==typeof n)return!0;if("undefined"!=typeof r.data("order")&&(o=r.data("order")),"input"===u){if(s=r.attr("type"),"undefined"==typeof s)return console.error("FormSerializer.serialize: input"+n+" must have a type");switch(s){case"checkbox":l=e._convertCheckbox(r,this.settings.checkboxMode);break;case"file":var c=r.get(0).files;if(0===c.length)return!0;l=c[0];break;default:l=r.val()}}else"select"===u?l=r.val():console.error("FormSerializer.serialize: only inputs and selects can be serialized");a[n]={val:l,order:o}}),i.set(a)}}]),t}();FormSerializer.checkboxMode={"boolean":0,number:1,string:2,onOff:3};var FormSerializerData=function(){function t(){return _classCallCheck(this,t),this.data={},this}return _createClass(t,[{key:"set",value:function(t){return this.data=t,this}},{key:"toString",value:function(){var t="",e=0,i=Object.keys(this.data).length;return Util.each(this.data,function(a,r){t+=a+"="+r.val,e++<i-1&&(t+="&")}),t}},{key:"toOrderedString",value:function(){var t="",e=[],i=[];Util.each(this.data,function(t,a){var r={name:t,val:a.val};a.order>-1?e[a.order]=r:i.push(r)});for(var a=e.length,r=0;r<a;r++)t+=e[r].name+"="+e[r].val,r<a&&(t+="&");for(a=i.length,r=0;r<a;r++)t+=i[r].name+"="+i[r].val,r<a-1&&(t+="&");return t}},{key:"toObject",value:function(){var t={};return Util.each(this.data,function(e,i){t[e]=i.val}),t}}]),t}(),Wizard=function(t){function e(t){var i;_classCallCheck(this,e);var a={struct:{$wrapper:".wizard",$navs:"ul.nav > li",$tabs:".tab-pane",$next:"li.next",$pager:"ul.pager",$previous:"li.previous"}},r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(a,t)));return r.stepCount=r.$tabs.length,r.step=0,r.toggleSubmitButton(1===r.stepCount),r.togglePreviousButton(!1),r.toggleNextButton(r.stepCount>1),r._setHandlers(),i=r,_possibleConstructorReturn(r,i)}return _inherits(e,t),_createClass(e,[{key:"_setHandlers",value:function(){var t=this;return this.$next.click(function(){t._getNextNav().find("a").click(),t.validatePreviousTab()}),this.$previous.click(function(){t._getPreviousNav().find("a").click(),t.validateNextTab()}),this.$submit.click(function(){t.validateAllTabs()}),this.$navs.each(function(e,i){$(i).click(function(){t._setPagination(e);var i=e;if(e>t.step)for(i;i>0;i--)t.validateTab(t._getTab(i));else if(e<t.step)for(i;i<t.step+1;i++)t.validateTab(t._getTab(i));t.step=e})}),this}},{key:"_useDefaultTemplate",value:function(){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_useDefaultTemplate",this).call(this),this.$form=this.$wrapper,this.$wrapper=$('<div class="wizard"></div>'),this.$navs=$('<ul class="nav"></ul>'),this.$tabs=$('<div class="tab-pane"></div>'),this.$pager=$('<ul class="pager"></ul>'),this.$next=$('<li class="next"><a href="#">Next</a></li>'),this.$previous=$('<li class="previous"><a href="#">Previous</a></li>'),this.$pager.append(this.$previous,this.$next,this.$submit),this.$footer.append(this.$pager),this.$form.append(this.$tabs,this.$footer),this.$wrapper.append(this.$navs,this.$form),this}},{key:"_validatorFactory",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":e.validators.formValidation.setup(this,t.options)}return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_validatorFactory",this).call(this)}},{key:"_setPagination",value:function(t){switch(this.togglePreviousButton(!1),this.toggleNextButton(!1),this.toggleSubmitButton(!1),t){case 0:this.togglePreviousButton(!1),1===this.stepCount?this.toggleSubmitButton():this.stepCount>1&&this.toggleNextButton();break;case this.stepCount-1:this.toggleSubmitButton(),this.stepCount>1&&this.togglePreviousButton();break;default:this.stepCount>1&&(this.toggleNextButton(),this.togglePreviousButton())}}},{key:"_getNav",value:function(t){return $(this.$navs.get(t))}},{key:"_getNavFromTab",value:function(t){var e=this.$tabs.index(t);return this._getNav(e)}},{key:"_getPreviousNav",value:function(){return $(this.$navs.get(this.step-1))}},{key:"_getCurrentNav",value:function(){return $(this.$navs.get(this.step))}},{key:"_getNextNav",value:function(){return $(this.$navs.get(this.step+1))}},{key:"_toggleNavInvalid",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.toggleClass("wizard-tab invalid",e),this}},{key:"_getTab",value:function(t){return $(this.$tabs.get(t))}},{key:"_getCurrentTab",value:function(){return $(this.$tabs.get(this.step))}},{key:"_getNextTab",value:function(){return this.step!==this.stepCount?$(this.$tabs.get(this.step+1)):null}},{key:"_getPreviousTab",value:function(){return this.step>0?$(this.$tabs.get(this.step-1)):null}},{key:"validateTab",value:function(t){var e=this.settings.validator.api,i=!0;"formValidation"===e?(this.validator.validateContainer(t),i=this.validator.isValidContainer(t)):console.log("Wizard.validateTab: no support for api: "+e);var a=this._getNavFromTab(t);return this._toggleNavInvalid(a,!i),i}},{key:"validateCurrentTab",value:function(){var t=this._getCurrentTab();return this.validateTab(t)}},{key:"validatePreviousTab",value:function(){var t=this._getPreviousTab();return this.validateTab(t)}},{key:"validateNextTab",value:function(){var t=this._getNextTab();return this.validateTab(t)}},{key:"validateAllTabs",value:function(){var t=this,e=!0;return $.each(this.tabs,function(i,a){var r=$(a);t.validator.validateContainer(r),e=t.validator.isValidContainer(r),t._toggleNavInvalid(t._getNav(i),!e)}),e}},{key:"toggleNextButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$next.toggle(t),this}},{key:"togglePreviousButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$previous.toggle(t),this}},{key:"toggleSubmitButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$submit.toggle(t),this}}]),e}(Form);Wizard.validators.formValidation.options.excluded=[":disabled"];