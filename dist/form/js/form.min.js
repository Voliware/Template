"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),_get=function t(e,i,r){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(void 0===a){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,r)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(r)},FormInput=function(t){function e(t){var i;_classCallCheck(this,e);var r={struct:{$wrapper:".form-input"}},a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return a.type="text",a.tag="input",a.disabled=!1,a.required=!1,a.name="input",a.maxlength=void 0,a.max=void 0,a.min=void 0,a.step=void 0,a.val=null,i=a,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"set",value:function(t){return Object.set(this,t),this}},{key:"_useDefaultTemplate",value:function(){var t=$('<input class="form-input"/>');return this._useTemplate(t),this}},{key:"_useTemplate",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_useTemplate",this).call(this,t),this._setAttrs()._setProps()._setVal(),this}},{key:"_setAttrs",value:function(){return this.$wrapper.attr({maxlength:this.maxlength,max:this.max,min:this.min,name:this.name,step:this.step,type:this.type}),this}},{key:"_setProps",value:function(){return this.$wrapper.prop("required",this.required),this.$wrapper.prop("disabled",this.disabled),this}},{key:"_setVal",value:function(){return null!==this.val&&this.$wrapper.val(this.val),this}}]),e}(Template),FormSelect=function(t){function e(t){var i;_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.tag="select",r.type=void 0,i=r,_possibleConstructorReturn(r,i)}return _inherits(e,t),_createClass(e,[{key:"_setAttrs",value:function(){return this.$wrapper.attr({name:this.name}),this}},{key:"addToSelect",value:function(){var t;return(t=this.$wrapper).addToSelect.apply(t,arguments),this}},{key:"selectOption",value:function(t){return this.$wrapper.val(t),this}}]),e}(FormInput),FormGroup=function(t){function e(t){var i;_classCallCheck(this,e);var r={formInput:FormInput,formSelect:FormSelect,struct:{$wrapper:".form-group",$label:"label",$inputWrapper:".form-input-wrapper",$input:"input"}},a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return a.input=null,i=a,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"_useDefaultTemplate",value:function(){var t='<div class="form-group"><label></label><div class="form-input-wrapper"></div></div>';return this._useTemplate(t),this}},{key:"createInput",value:function(t){return this.input="input"===t.tag?new this.settings.formInput:new this.settings.formSelect,this.input.set(t),this.setInput(this.input),this}},{key:"setInput",value:function(t){return t=t instanceof Template?t.$wrapper:t,this.$inputWrapper.html(t),this.$input=t,this}},{key:"setLabel",value:function(t){return this.$label.html(t),this}}]),e}(Template),FormGroupManager=function(t){function e(t){var i;_classCallCheck(this,e);var r={identifier:"label",template:FormGroup},a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return i=a,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"_create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(new this.settings.template).createInput(e.input).setLabel(e.label);return this._add(i,t)}},{key:"_populateTemplate",value:function(t,e){return t.createInput(e.input).setLabel(e.label),this}}]),e}(TemplateManager),FormSerializer=function(){function t(e){_classCallCheck(this,t);var i={checkboxMode:t.checkboxMode.number,serializeMode:t.serializeMode.toString,excluded:[":disabled"]};return this.settings=$Util.opts(i,e,"replace"),this}return _createClass(t,[{key:"_getElName",value:function(t){return"undefined"!=typeof t.attr("name")?t.attr("name"):"undefined"!=typeof t.data("name")?t.data("name"):(console.error("FormSerializer._getElName: field has no name or data-name attribute"),"")}},{key:"_convertCheckbox",value:function(e,i){var r=e.is(":checked");switch(i){case t.checkboxMode["boolean"]:return r;case t.checkboxMode.number:return r?1:0;case t.checkboxMode.string:return r?"1":"0";case t.checkboxMode.onOff:return r?"on":"off"}}},{key:"serialize",value:function(e){var i=this,r=new FormSerializerData,a={};switch(e.find("input, select").each(function(t,e){for(var r=$(e),s="",o=-1,n="",l="",u="",c=i.settings.excluded,h=0;h<c.length;h++)if(r.is(c[h]))return!0;if(r.data("serialize")===!1)return!0;if(l=r[0].nodeName.toLowerCase(),s=i._getElName(r),"undefined"==typeof s)return!0;if("undefined"!=typeof r.data("order")&&(o=r.data("order")),"input"===l){if(n=r.attr("type"),"undefined"==typeof n)return console.error("FormSerializer.serialize: input"+s+" must have a type");switch(n){case"checkbox":u=i._convertCheckbox(r,i.settings.checkboxMode);break;case"radio":if(!r.is(":checked"))return!0;u=r.val();break;case"file":var d=r.get(0).files;if(0===d.length)return!0;u=d[0];break;default:u=r.val()}}else"select"===l?u=r.val():console.error("FormSerializer.serialize: only inputs and selects can be serialized");a[s]={val:u,order:o}}),r.set(a),this.settings.serializeMode){default:case t.serializeMode.toString:return r.toString();case t.serializeMode.toOrderedString:return r.toOrderedString();case t.serializeMode.toObject:return r.toObject();case t.serializeMode.toValue:return r.toValue()}}}]),t}();FormSerializer.checkboxMode={"boolean":0,number:1,string:2,onOff:3},FormSerializer.serializeMode={toString:0,toOrderedString:1,toObject:2,toValue:3};var FormSerializerData=function(){function t(e){return _classCallCheck(this,t),this.data=e||{},this}return _createClass(t,[{key:"set",value:function(t){return this.data=t,this}},{key:"toString",value:function(){var t="",e=0,i=Object.keys(this.data).length;return Util.each(this.data,function(r,a){t+=r+"="+a.val,e++<i-1&&(t+="&")}),t}},{key:"toOrderedString",value:function(){var t="",e=[],i=[];Util.each(this.data,function(t,r){var a={name:t,val:r.val};r.order>-1?e[r.order]=a:i.push(a)});for(var r=e.length,a=0;a<r;a++)t+=e[a].name+"="+e[a].val,a<r&&(t+="&");for(r=i.length,a=0;a<r;a++)t+=i[a].name+"="+i[a].val,a<r-1&&(t+="&");return t}},{key:"toObject",value:function(){var t={};return Util.each(this.data,function(e,i){t[e]=""===i.val||isNaN(i.val)?t[e]=i.val:parseInt(i.val)}),t}},{key:"toValue",value:function(){var t=null;return Util.each(this.data,function(e,i){t=isNaN(i.val)?i.val:parseInt(i.val)}),t}}]),t}(),Form=function(t){function e(t){var i;_classCallCheck(this,e);var r={feedback:!0,useTemplate:!0,submitUrl:"",submitRequest:null,serializeMode:FormSerializer.serializeMode.toString,checkboxMode:FormSerializer.checkboxMode.number,excluded:[":disabled"],formGroupManager:FormGroupManager,struct:{$wrapper:"form",$feedback:".form-feedback",$header:".form-header",$body:".form-body",$footer:".form-footer",$cancel:".form-cancel",$reset:".form-reset",$submit:'button[type="submit"]'},validator:null},a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t,"replace"))),s=a;a._serializedData={};var o=a.$wrapper.find("form");return a.$form=o.length>0?o:a.$wrapper,a.formSerializer=new FormSerializer({serializeMode:a.settings.serializeMode,checkboxMode:a.settings.checkboxMode,excluded:a.settings.excluded}),a.validator=null,a.feedback=null,a.formGoupManager=new a.settings.formGroupManager({$wrapper:a.$body}),a.$form.on("submit",function(t){t.preventDefault(),s.serializeForm()._submit()}),a.$cancel.click(function(){s.resetForm()}),a.$reset.click(function(){s.resetForm()}),a.settings.validator&&a._setupValidator(),a.settings.feedback&&a._setupFeedback(),i=a,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"_useDefaultTemplate",value:function(){var t='<form class="form"><div class="form-feedback"></div><div class="form-header"></div><div class="form-body"></div><div class="form-footer"><button type="submit" class="form-submit">Submit</button><button type="button" class="form-reset">Reset</button><button type="button" class="form-cancel">Cancel</button></div></form>';return this._useTemplate($(t)),this}},{key:"_setupValidator",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":e.validators.formValidation.setup(this,this.$form,t.options)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$form.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_prepare",value:function(){return this.toggleForm(!1),this.feedback.show(),this.feedback.setFeedback("processing","Getting data..."),this}},{key:"build",value:function(t){return this.formGoupManager.build(t),this}},{key:"_ready",value:function(){return this.feedback.slideUp(),this.slideToggleForm(!0),this}},{key:"_submit",value:function(){var t=this;return this.trigger("beforeSubmit",this),this.feedback&&this.feedback.setFeedback("processing","Processing..."),this._doSubmit().done(function(e){t._done(e)}).fail(function(e){t._fail(e)}).always(function(){t._always()})}},{key:"_doSubmit",value:function(){var t=this.settings;return t.submitRequest?t.submitRequest(this._serializedData):$.post(t.submitUrl,this._serializedData)}},{key:"_done",value:function(t){return this.feedback&&this.feedback.setFeedback("success"," Operation was successful"),this.trigger("done",t),this}},{key:"_fail",value:function(t){return this.feedback&&this.feedback.setFeedback("danger","Operation has failed"),this.trigger("fail",t),this}},{key:"_always",value:function(){return this.toggleButtons(!0),this.trigger("always"),this}},{key:"_getFormData",value:function(){return $.Deferred().resolve().promise()}},{key:"toggleButtons",value:function(t){return this.$cancel.prop("disabled",!t),this.$reset.prop("disabled",!t),this.$submit.prop("disabled",!t).toggleClass("disabled",!t),this}},{key:"lockSubmit",value:function(t){function e(){if(a>=t)clearInterval(s);else{var e=Math.floor((t-a)/1e3);e=e||1;var o=r+" | "+e;i.$submit.html(o),a+=1e3}}var i=this,r=this.$submit.html();this.$submit.prop("disabled",!0),setTimeout(function(){i.$submit.prop("disabled",!1),i.$submit.html(r)},t);var a=0,s=setInterval(e,1e3);e()}},{key:"toggleForm",value:function(t){return this.$body.toggle(t),this.$footer.toggle(t),this}},{key:"slideToggleForm",value:function(t){return this.$body.slideToggleState(t),this.$footer.slideToggleState(t),this}},{key:"populateForm",value:function(t){return this._cacheData(t),this._processData(t),this.$form.populateChildren(this._processedData),this}},{key:"serializeForm",value:function(){return this._serializedData=this.formSerializer.serialize(this.$form),this}},{key:"resetForm",value:function(){if($.isEmptyObject(this._cachedData)?this.$form[0].reset():this.populateForm(this._cachedData),this.feedback&&this.feedback.slideUp(),this.toggleButtons(!0),this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm()}return this}},{key:"validate",value:function(){var t=!1;if(this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm(),this.validator.validateContainer(this.$form),t=this.validator.isValidContainer(this.$form)}return t}},{key:"clean",value:function(){return this._cachedData={},this.resetForm(),this.toggleForm(!0),this}},{key:"initialize",value:function(){return this.clean(),this}}]),e}(Template);Form.validators={formValidation:{api:"formValidation",options:{framework:"bootstrap",excluded:[":disabled",":hidden",":not(:visible)"],icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}},setup:function(t,e,i){e.off("submit"),e.data("formValidation")&&e.data("formValidation").destroy(),e.formValidation(i).on("success.form.fv",function(e){e.preventDefault(),t.toggleButtons(!1),t.serializeForm()._submit()}),t.validator=e.data("formValidation")}}};var Wizard=function(t){function e(t){var i;_classCallCheck(this,e);var r={struct:{$wrapper:".wizard",$nav:"ul.nav",$navs:"ul.nav > li",$tabs:".tab-pane",$next:"li.next",$pager:"ul.pager",$previous:"li.previous"}},a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,$Util.opts(r,t)));return a.stepCount=a.$tabs.length,a.step=0,a.toggleSubmitButton(1===a.stepCount),a.togglePreviousButton(!1),a.toggleNextButton(a.stepCount>1),a._setHandlers(),i=a,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"_clearHandlers",value:function(){this.$next.off("click.wizard"),this.$previous.off("click.wizard"),this.$submit.off("click.wizard"),this.$navs.each(function(t,e){$(e).off("click.wizard")})}},{key:"_setHandlers",value:function(){var t=this;return this._clearHandlers(),this.$next.on("click.wizard",function(){t._getNextNav().find("a").click()}),this.$previous.on("click.wizard",function(){t.validateTab(t._getTab(t.step)),t._getPreviousNav().find("a").click()}),this.$submit.on("click.wizard",function(){t.validateAllTabs()}),this.$navs.each(function(e,i){$(i).on("click.wizard",function(){t._setPagination(e);var i=e;if(e>t.step)for(i-=1;i>=0;i--)t.validateTab(t._getTab(i));else if(e<t.step)for(i;i<t.step+1;i++)t.validateTab(t._getTab(i));t.step=e,t._toggleNavInvalid($(this),!1)})}),this}},{key:"_useDefaultTemplate",value:function(){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_useDefaultTemplate",this).call(this),this.$form=this.$wrapper,this.$wrapper=$('<div class="wizard"></div>'),this.$nav=$('<ul class="nav"></ul>'),this.$tabs=$('<div class="tab-pane"></div>'),this.$pager=$('<ul class="pager"></ul>'),this.$next=$('<li class="next"><a href="#">Next</a></li>'),this.$previous=$('<li class="previous"><a href="#">Previous</a></li>'),this.$pager.append(this.$previous,this.$next,this.$submit),this.$footer.append(this.$pager),this.$form.append(this.$tabs,this.$footer),this.$wrapper.append(this.$nav,this.$form),this}},{key:"_setupValidator",value:function(){var t=this.settings.validator;switch(t.api){case"formValidation":var i=$.extend(!0,{},t.options);i.excluded=[":disabled"],e.validators.formValidation.setup(this,this.$form,i)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$wrapper.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_setPagination",value:function(t){switch(this.togglePreviousButton(!1),this.toggleNextButton(!1),this.toggleSubmitButton(!1),t){case 0:this.togglePreviousButton(!1),1===this.stepCount?this.toggleSubmitButton():this.stepCount>1&&this.toggleNextButton();break;case this.stepCount-1:this.toggleSubmitButton(),this.stepCount>1&&this.togglePreviousButton();break;default:this.stepCount>1&&(this.toggleNextButton(),this.togglePreviousButton())}}},{key:"_getNav",value:function(t){return $(this.$navs.get(t))}},{key:"_getNavFromTab",value:function(t){var e=this.$tabs.index(t);return this._getNav(e)}},{key:"_getPreviousNav",value:function(){return $(this.$navs.get(this.step-1))}},{key:"_getCurrentNav",value:function(){return $(this.$navs.get(this.step))}},{key:"_getNextNav",value:function(){return $(this.$navs.get(this.step+1))}},{key:"_toggleNavInvalid",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.toggleClass("wizard-tab invalid",e),this}},{key:"_getTab",value:function(t){return $(this.$tabs.get(t))}},{key:"_getCurrentTab",value:function(){return $(this.$tabs.get(this.step))}},{key:"_getNextTab",value:function(){return this.step!==this.stepCount?$(this.$tabs.get(this.step+1)):null}},{key:"_getPreviousTab",value:function(){return this.step>0?$(this.$tabs.get(this.step-1)):null}},{key:"validateTab",value:function(t){var e=this.settings.validator.api,i=!0;switch(e){case"formValidation":this.validator.validateContainer(t),i=this.validator.isValidContainer(t)}var r=this._getNavFromTab(t);return this._toggleNavInvalid(r,!i),i}},{key:"validateCurrentTab",value:function(){var t=this._getCurrentTab();return this.validateTab(t)}},{key:"validatePreviousTab",value:function(){var t=this._getPreviousTab();return this.validateTab(t)}},{key:"validateNextTab",value:function(){var t=this._getNextTab();return this.validateTab(t)}},{key:"validateAllTabs",value:function(){var t=this,e=!0;return $.each(this.$tabs,function(i,r){var a=$(r);t.validator.validateContainer(a);var s=t.validator.isValidContainer(a);t._toggleNavInvalid(t._getNav(i),!s),s||(e=!1)}),e}},{key:"toggleNextButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$next.toggle(t),this}},{key:"togglePreviousButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$previous.toggle(t),this}},{key:"toggleSubmitButton",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$submit.toggle(t),this}},{key:"toggleForm",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toggleForm",this).call(this,t),this.$nav.toggle(t),this}},{key:"slideToggleForm",value:function(t){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"slideToggleForm",this).call(this,t),this.$nav.slideToggleState(t),this}},{key:"resetNavValidation",value:function(){for(var t=0;t<this.$navs.length;t++){var e=$(this.$navs[t]);this._toggleNavInvalid(e,!1)}return this}},{key:"resetForm",value:function(){var t=$(this.$navs[0]);return t.find("a").click(),this.resetNavValidation(),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resetForm",this).call(this),this}}]),e}(Form);