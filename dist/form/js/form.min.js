"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,i,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,a)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(a)},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),Form=function(e){function t(e){var i;_classCallCheck(this,t);var a={feedback:!0,useTemplate:!0,submitUrl:"",submitRequest:null,serializeMode:FormSerializer.serializeMode.toString,checkboxMode:FormSerializer.checkboxMode.number,excluded:[":disabled"],struct:{$wrapper:"form",$feedback:".form-feedback",$header:".form-header",$body:".form-body",$footer:".form-footer",$cancel:".form-cancel",$reset:".form-reset",$submit:'button[type="submit"]'},validator:null},r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$Util.opts(a,e,"replace"))),s=r;r._serializedData={};var o=r.$wrapper.find("form");return r.$form=o.length>0?o:r.$wrapper,r.formSerializer=new FormSerializer({serializeMode:r.settings.serializeMode,checkboxMode:r.settings.checkboxMode,excluded:r.settings.excluded}),r.validator=null,r.feedback=null,r.$form.on("submit",function(e){e.preventDefault(),s.serializeForm()._submit()}),r.$cancel.click(function(){s.resetForm()}),r.$reset.click(function(){s.resetForm()}),r.settings.validator&&r._setupValidator(),r.settings.feedback&&r._setupFeedback(),i=r,_possibleConstructorReturn(r,i)}return _inherits(t,e),_createClass(t,[{key:"_useDefaultTemplate",value:function(){var e='<form class="form"><div class="form-feedback"></div><div class="form-header"></div><div class="form-body"></div><div class="form-footer"><button type="submit" class="form-submit">Submit</button><button type="button" class="form-reset">Reset</button><button type="button" class="form-cancel">Cancel</button></div></form>';return this._useTemplate($(e)),this}},{key:"_setupValidator",value:function(){var e=this.settings.validator;switch(e.api){case"formValidation":t.validators.formValidation.setup(this,this.$form,e.options)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$form.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_prepare",value:function(){return this.toggleForm(!1),this.feedback.show(),this.feedback.setFeedback("processing","Getting data..."),this}},{key:"_ready",value:function(){return this.feedback.slideUp(),this.slideToggleForm(!0),this}},{key:"_submit",value:function(){var e=this;return this.trigger("beforeSubmit",this),this.feedback&&this.feedback.setFeedback("processing","Processing..."),this._doSubmit().done(function(t){e._done(t)}).fail(function(t){e._fail(t)}).always(function(){e._always()})}},{key:"_doSubmit",value:function(){var e=this.settings;return e.submitRequest?e.submitRequest(this._serializedData):$.post(e.submitUrl,this._serializedData)}},{key:"_done",value:function(e){return this.feedback&&this.feedback.setFeedback("success"," Operation was successful"),this.trigger("done",e),this}},{key:"_fail",value:function(e){return this.feedback&&this.feedback.setFeedback("danger","Operation has failed"),this.trigger("fail",e),this}},{key:"_always",value:function(){return this.toggleButtons(!0),this.trigger("always"),this}},{key:"_getFormData",value:function(){return $.Deferred().resolve().promise()}},{key:"toggleButtons",value:function(e){return this.$cancel.prop("disabled",!e),this.$reset.prop("disabled",!e),this.$submit.prop("disabled",!e).toggleClass("disabled",!e),this}},{key:"lockSubmit",value:function(e){function t(){if(r>=e)clearInterval(s);else{var t=Math.floor((e-r)/1e3);t=t||1;var o=a+" | "+t;i.$submit.html(o),r+=1e3}}var i=this,a=this.$submit.html();this.$submit.prop("disabled",!0),setTimeout(function(){i.$submit.prop("disabled",!1),i.$submit.html(a)},e);var r=0,s=setInterval(t,1e3);t()}},{key:"toggleForm",value:function(e){return this.$body.toggle(e),this.$footer.toggle(e),this}},{key:"slideToggleForm",value:function(e){return this.$body.slideToggleState(e),this.$footer.slideToggleState(e),this}},{key:"populateForm",value:function(e){return this._cacheData(e),this._processData(e),this.$form.populateChildren(e),this}},{key:"serializeForm",value:function(){return this._serializedData=this.formSerializer.serialize(this.$form),this}},{key:"resetForm",value:function(){if($.isEmptyObject(this._cachedData)?this.$form[0].reset():this.populateForm(this._cachedData),this.feedback&&this.feedback.slideUp(),this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm()}return this}},{key:"validate",value:function(){var e=!1;if(this.validator)switch(this.settings.validator.api){case"formValidation":this.validator.resetForm(),this.validator.validateContainer(this.$form),e=this.validator.isValidContainer(this.$form)}return e}},{key:"clean",value:function(){return this._cachedData={},this.resetForm(),this.toggleForm(!0),this}},{key:"initialize",value:function(){return this.clean(),this}}]),t}(Template);Form.validators={formValidation:{api:"formValidation",options:{framework:"bootstrap",excluded:[":disabled",":hidden",":not(:visible)"],icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}},setup:function(e,t,i){t.off("submit"),t.data("formValidation")&&t.data("formValidation").destroy(),t.formValidation(i).on("success.form.fv",function(t){t.preventDefault(),e.toggleButtons(!1),e.serializeForm()._submit()}),e.validator=t.data("formValidation")}}};var FormSerializer=function(){function e(t){_classCallCheck(this,e);var i={checkboxMode:e.checkboxMode.number,serializeMode:e.serializeMode.toString,excluded:[":disabled"]};return this.settings=$Util.opts(i,t,"replace"),this}return _createClass(e,[{key:"_getElName",value:function(e){return"undefined"!=typeof e.attr("name")?e.attr("name"):"undefined"!=typeof e.data("name")?e.data("name"):(console.error("FormSerializer._getElName: field has no name or data-name attribute"),"")}},{key:"_convertCheckbox",value:function(t,i){var a=t.is(":checked");switch(i){case e.checkboxMode["boolean"]:return a;case e.checkboxMode.number:return a?1:0;case e.checkboxMode.string:return a?"1":"0";case e.checkboxMode.onOff:return a?"on":"off"}}},{key:"serialize",value:function(t){var i=this,a=new FormSerializerData,r={};switch(t.find("input, select").each(function(e,t){for(var a=$(t),s="",o=-1,n="",l="",u="",c=i.settings.excluded,h=0;h<c.length;h++)if(a.is(c[h]))return!0;if(a.data("serialize")===!1)return!0;if(l=a[0].nodeName.toLowerCase(),s=i._getElName(a),"undefined"==typeof s)return!0;if("undefined"!=typeof a.data("order")&&(o=a.data("order")),"input"===l){if(n=a.attr("type"),"undefined"==typeof n)return console.error("FormSerializer.serialize: input"+s+" must have a type");switch(n){case"checkbox":u=i._convertCheckbox(a,i.settings.checkboxMode);break;case"radio":if(!a.is(":checked"))return!0;u=a.val();break;case"file":var d=a.get(0).files;if(0===d.length)return!0;u=d[0];break;default:u=a.val()}}else"select"===l?u=a.val():console.error("FormSerializer.serialize: only inputs and selects can be serialized");r[s]={val:u,order:o}}),a.set(r),this.settings.serializeMode){default:case e.serializeMode.toString:return a.toString();case e.serializeMode.toOrderedString:return a.toOrderedString();case e.serializeMode.toObject:return a.toObject();case e.serializeMode.toValue:return a.toValue()}}}]),e}();FormSerializer.checkboxMode={"boolean":0,number:1,string:2,onOff:3},FormSerializer.serializeMode={toString:0,toOrderedString:1,toObject:2,toValue:3};var FormSerializerData=function(){function e(t){return _classCallCheck(this,e),this.data=t||{},this}return _createClass(e,[{key:"set",value:function(e){return this.data=e,this}},{key:"toString",value:function(){var e="",t=0,i=Object.keys(this.data).length;return Util.each(this.data,function(a,r){e+=a+"="+r.val,t++<i-1&&(e+="&")}),e}},{key:"toOrderedString",value:function(){var e="",t=[],i=[];Util.each(this.data,function(e,a){var r={name:e,val:a.val};a.order>-1?t[a.order]=r:i.push(r)});for(var a=t.length,r=0;r<a;r++)e+=t[r].name+"="+t[r].val,r<a&&(e+="&");for(a=i.length,r=0;r<a;r++)e+=i[r].name+"="+i[r].val,r<a-1&&(e+="&");return e}},{key:"toObject",value:function(){var e={};return Util.each(this.data,function(t,i){e[t]=""===i.val||isNaN(i.val)?e[t]=i.val:parseInt(i.val)}),e}},{key:"toValue",value:function(){var e=null;return Util.each(this.data,function(t,i){e=isNaN(i.val)?i.val:parseInt(i.val)}),e}}]),e}(),Wizard=function(e){function t(e){var i;_classCallCheck(this,t);var a={struct:{$wrapper:".wizard",$nav:"ul.nav",$navs:"ul.nav > li",$tabs:".tab-pane",$next:"li.next",$pager:"ul.pager",$previous:"li.previous"}},r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$Util.opts(a,e)));return r.stepCount=r.$tabs.length,r.step=0,r.toggleSubmitButton(1===r.stepCount),r.togglePreviousButton(!1),r.toggleNextButton(r.stepCount>1),r._setHandlers(),i=r,_possibleConstructorReturn(r,i)}return _inherits(t,e),_createClass(t,[{key:"_clearHandlers",value:function(){this.$next.off("click.wizard"),this.$previous.off("click.wizard"),this.$submit.off("click.wizard"),this.$navs.each(function(e,t){$(t).off("click.wizard")})}},{key:"_setHandlers",value:function(){var e=this;return this._clearHandlers(),this.$next.on("click.wizard",function(){e._getNextNav().find("a").click()}),this.$previous.on("click.wizard",function(){e.validateTab(e._getTab(e.step)),e._getPreviousNav().find("a").click()}),this.$submit.on("click.wizard",function(){e.validateAllTabs()}),this.$navs.each(function(t,i){$(i).on("click.wizard",function(){e._setPagination(t);var i=t;if(t>e.step)for(i-=1;i>=0;i--)e.validateTab(e._getTab(i));else if(t<e.step)for(i;i<e.step+1;i++)e.validateTab(e._getTab(i));e.step=t,e._toggleNavInvalid($(this),!1)})}),this}},{key:"_useDefaultTemplate",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_useDefaultTemplate",this).call(this),this.$form=this.$wrapper,this.$wrapper=$('<div class="wizard"></div>'),this.$nav=$('<ul class="nav"></ul>'),this.$tabs=$('<div class="tab-pane"></div>'),this.$pager=$('<ul class="pager"></ul>'),this.$next=$('<li class="next"><a href="#">Next</a></li>'),this.$previous=$('<li class="previous"><a href="#">Previous</a></li>'),this.$pager.append(this.$previous,this.$next,this.$submit),this.$footer.append(this.$pager),this.$form.append(this.$tabs,this.$footer),this.$wrapper.append(this.$nav,this.$form),this}},{key:"_setupValidator",value:function(){var e=this.settings.validator;switch(e.api){case"formValidation":var i=$.extend(!0,{},e.options);i.excluded=[":disabled"],t.validators.formValidation.setup(this,this.$form,i)}return this}},{key:"_setupFeedback",value:function(){return this.feedback=new Feedback,this.$feedback.length||(this.$feedback=$('<div class="form-feedback"></div>'),this.$wrapper.prepend(this.$feedback)),this.$feedback.html(this.feedback.$wrapper),this}},{key:"_setPagination",value:function(e){switch(this.togglePreviousButton(!1),this.toggleNextButton(!1),this.toggleSubmitButton(!1),e){case 0:this.togglePreviousButton(!1),1===this.stepCount?this.toggleSubmitButton():this.stepCount>1&&this.toggleNextButton();break;case this.stepCount-1:this.toggleSubmitButton(),this.stepCount>1&&this.togglePreviousButton();break;default:this.stepCount>1&&(this.toggleNextButton(),this.togglePreviousButton())}}},{key:"_getNav",value:function(e){return $(this.$navs.get(e))}},{key:"_getNavFromTab",value:function(e){var t=this.$tabs.index(e);return this._getNav(t)}},{key:"_getPreviousNav",value:function(){return $(this.$navs.get(this.step-1))}},{key:"_getCurrentNav",value:function(){return $(this.$navs.get(this.step))}},{key:"_getNextNav",value:function(){return $(this.$navs.get(this.step+1))}},{key:"_toggleNavInvalid",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.toggleClass("wizard-tab invalid",t),this}},{key:"_getTab",value:function(e){return $(this.$tabs.get(e))}},{key:"_getCurrentTab",value:function(){return $(this.$tabs.get(this.step))}},{key:"_getNextTab",value:function(){return this.step!==this.stepCount?$(this.$tabs.get(this.step+1)):null}},{key:"_getPreviousTab",value:function(){return this.step>0?$(this.$tabs.get(this.step-1)):null}},{key:"validateTab",value:function(e){var t=this.settings.validator.api,i=!0;switch(t){case"formValidation":this.validator.validateContainer(e),i=this.validator.isValidContainer(e)}var a=this._getNavFromTab(e);return this._toggleNavInvalid(a,!i),i}},{key:"validateCurrentTab",value:function(){var e=this._getCurrentTab();return this.validateTab(e)}},{key:"validatePreviousTab",value:function(){var e=this._getPreviousTab();return this.validateTab(e)}},{key:"validateNextTab",value:function(){var e=this._getNextTab();return this.validateTab(e)}},{key:"validateAllTabs",value:function(){var e=this,t=!0;return $.each(this.$tabs,function(i,a){var r=$(a);e.validator.validateContainer(r);var s=e.validator.isValidContainer(r);e._toggleNavInvalid(e._getNav(i),!s),s||(t=!1)}),t}},{key:"toggleNextButton",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$next.toggle(e),this}},{key:"togglePreviousButton",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$previous.toggle(e),this}},{key:"toggleSubmitButton",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.$submit.toggle(e),this}},{key:"toggleForm",value:function(e){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toggleForm",this).call(this,e),this.$nav.toggle(e),this}},{key:"slideToggleForm",value:function(e){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"slideToggleForm",this).call(this,e),this.$nav.slideToggleState(e),this}},{key:"resetNavValidation",value:function(){for(var e=0;e<this.$navs.length;e++){var t=$(this.$navs[e]);this._toggleNavInvalid(t,!1)}return this}},{key:"resetForm",value:function(){var e=$(this.$navs[0]);return e.find("a").click(),this.resetNavValidation(),_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resetForm",this).call(this),this}}]),t}(Form);