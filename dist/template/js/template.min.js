"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get2=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"each",value:function(e,t){for(var n in e){var i=e[n];t(n,i)}}}]),e}();if("undefined"==typeof isDefined&&(window.isDefined=function(e){return"undefined"!=typeof e}),"undefined"==typeof isNull&&(window.isNull=function(e){return null===e}),"undefined"==typeof isFunction&&(window.isFunction=function(e){return"function"==typeof e}),"undefined"==typeof isString&&(window.isString=function(e){return"string"==typeof e}),"undefined"==typeof isNumber&&(window.isNumber=function(e){return"number"==typeof e}),"undefined"==typeof isObject&&(window.isObject=function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}),"undefined"==typeof getType&&(window.getType=function(e){return null===e?"[object Null]":Object.prototype.toString.call(e)}),"undefined"==typeof Array.diff&&(Array.diff=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})}),"undefined"==typeof Array.min&&(Array.min=function(e){return Math.min.apply(Math,e)}),"undefined"==typeof Array.max&&(Array.max=function(e){return Math.max.apply(Math,e)}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}),!isDefined($))throw new ReferenceError("util-jquery requires jquery 2.2.2 or greater");"undefined"==typeof isJquery&&(window.isJquery=function(e){return e instanceof $});var $Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"jQuerify",value:function(t){if(!t.$wrapper)throw new ReferenceError("$Util.jQuerify: $wrapper must be a property of the first argument");Util.each(e.jqueryPrototype,function(e,n){t[n]=function(){var e;return(e=t.$wrapper)[n].apply(e,arguments),t}})}},{key:"opts",value:function(e,t){return $.extend(!0,e,t)}}]),e}();$Util.jqueryPrototype=Object.getOwnPropertyNames($.prototype),$Util.populate={},function(e){e.fn.addToSelect=function(){var t={};arguments.length>1?t[arguments[0]]=arguments[1]:t=arguments[0];var n=e(this);return n.is("select")&&Util.each(t,function(e,t){var i='<option value="'+e+'">'+t+"</option>";n.append(i)}),this},e.fn.hasAttr=function(t){return e(this).is("["+t+"]")},e.fn.populate=function(t){function n(e,t,n){switch(e){case"input":r(t,n);break;case"select":case"textarea":s.val(n);break;case"img":s.attr("src",n);break;case"button":s.prop("disabled",0===n);break;default:s.html(n)}}function i(e){return $Util.populate[e]?$Util.populate[e]:s.hasAttr("data-tag")?$Util.populate[s.attr("data-tag")]:null}function r(e,t){switch(e){case"checkbox":var n=s.data("checked");t.toString()!==n&&"1"!==t.toString()&&t!==!0||s.prop("checked",!0);break;case"radio":t===s.attr("value")&&s.prop("checked",!0);break;default:s.val(t)}}var s=e(this),a=s.prop("tagName").toLowerCase(),o=s.attr("type"),u=i(a);return u?u.call(this,t):n(a,o,t),this},e.fn.populateChildren=function(t){var n=e(this);return Util.each(t,function(e,t){var i=n.find('[name="'+e+'"]');0===i.length&&(i=n.find('[data-name="'+e+'"]')),i.length>0&&i.data("populate")!==!1&&i.populate(t)}),this},e.fn.slideToggleState=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t?e(this).slideDown(n,i):e(this).slideUp(n,i),this},e.fn.toggleOption=function(){var t=e(this);if(!t.is("select"))return this;var n,i;if(arguments.length>1){i=arguments[0],e.isArray(i)||(i=[i]),n=arguments[1];for(var r=0;r<i.length;r++)t.find('option[value="'+i[r]+'"]').prop("disabled",!n)}else n=arguments[0],t.find("option").prop("disabled",!n);return this}}(jQuery);var EventSystem=function(){function e(){return _classCallCheck(this,e),this.events={},this}return _createClass(e,[{key:"_create",value:function(e){return this.events[e]={callbacks:[]}}},{key:"_destroy",value:function(e){return isDefined(this.event[e])&&delete this.event[e],this}},{key:"on",value:function(e,t){var n=this.events[e];return isDefined(n)||(n=this._create(e)),n.callbacks.push(t),this}},{key:"off",value:function(e,t){var n=this.events[e];if(isDefined(n)){var i=n.callbacks.indexOf(t);i>-1&&n.callbacks.splice(i,1)}return this}},{key:"offAll",value:function(e){var t=this.events[e];return isDefined(t)&&(t[e].callbacks=[]),this}},{key:"trigger",value:function(){var e=[].shift,t=e.apply(arguments),n=this.events[t];if(!isDefined(n))return this;for(var i=0;i<n.callbacks.length;i++){var r;(r=n.callbacks)[i].apply(r,arguments)}return this}},{key:"emit",value:function(){return this.trigger()}}]),e}();if(!isDefined(EventSystem))throw new ReferenceError("Manager requires EventSystem");var Manager=function(e){function t(e){var n;_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r={identifier:"id",useObjectNames:!1};return i.settings=Object.assign(r,e),i.objects={},i.count=0,i._cachedData={},i.serializedObjects=[],i.requiresNewSerialize=!1,n=i,_possibleConstructorReturn(i,n)}return _inherits(t,e),_createClass(t,[{key:"_exists",value:function(){var e=arguments[0];return isString(e)||isNumber(e)?isDefined(this.objects[e]):isDefined(this.objects[e[this.settings.identifier]])}},{key:"_get",value:function(){var e=arguments[0];return isString(e)||isNumber(e)?this.objects[e]:this.objects[e[this.settings.identifier]]}},{key:"_add",value:function(e,t){function n(){i.requiresNewSerialize=!0,i.trigger("add",e),i.count++,e._count=i.count}var i=this,r=this.settings.identifier;return isDefined(t)?(String(t),e[r]=t,this.objects[t]=e,n()):e[r]?(this.objects[e[r]]=e,n()):console.warn("Manager._add: cannot add an object with no identifier"),e}},{key:"_update",value:function(e,t){function n(){i.requiresNewSerialize=!0,i.trigger("add",e),i.count++,e._count=i.count}var i=this,r=this.settings.identifier;return isDefined(t)?(String(t),this.objects[t]=e,n()):e[r]?(this.objects[e[r]]=e,n()):console.warn("Manager._update: cannot update an object with no identifier"),e}},{key:"_delete",value:function(){var e=arguments[0],t=null,n=this.settings.identifier;if(isString(e)||isNumber(e)?(String(e),this.objects[e]&&(t=this.objects[e])):this.objects[e[n]]?t=this.objects[e[n]]:console.warn("Manager._delete: cannot delete an object with no identifier"),t){var i=t[n];this.trigger("delete",i),delete this.objects[i],this.requiresNewSerialize=!0,this.count>0&&this.count--}return this}},{key:"_empty",value:function(){for(var e in this.objects)delete this.objects[e];return this}},{key:"_cacheData",value:function(e){return this._cachedData=Object.create(e),this}},{key:"_processData",value:function(e){return e}},{key:"getIds",value:function(){var e=[];for(var t in this.objects)e.push(t);return e}},{key:"getId",value:function(e){return e[this.settings.identifier]}},{key:"manage",value:function(e){if(e=this._processData(e),!isObject(e)&&this.settings.useObjectNames)throw new Error("Manager.manage: to use option useObjectNames, object passed to manage() must be an object.");var t=this,n=this.settings.identifier,i=[];for(var r in e){var s=e[r];if(this.settings.useObjectNames&&(s[n]=r),!isDefined(s[n]))return console.error("Manager.manage: cannot manage objects with no ids");var a=s[n].toString(),o=t.objects[a];isDefined(o)?t._update(s):t._add(s),i.push(a)}var u=this.getIds(),l=Array.diff(u,i);for(r=0;r<l.length;r++)this._delete(l[r]);return this}},{key:"exists",value:function(){return this._exists.apply(this,arguments)}},{key:"addObjects",value:function(){var e=arguments.length>1?[].slice.call(arguments).sort():arguments[0];for(var t in e){var n=e[t];this.addObject(n)}return this}},{key:"addObject",value:function(){return this._add.apply(this,arguments)}},{key:"getObject",value:function(){return this._get.apply(this,arguments)}},{key:"updateObject",value:function(){return this._update.apply(this,arguments)}},{key:"deleteObject",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteObjects",value:function(){return this._empty()}},{key:"serializer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.requiresNewSerialize){var n=this;this.serializedObjects=[],$.each(this.objects,function(e,t){t.serializer&&n.serializedObjects.push(t.serializer())})}return t=t>0?t:this.serializedObjects.length,this.serializedObjects.slice(e,t)}}]),t}(EventSystem),Template=function(){function e(t){_classCallCheck(this,e);var n={template:null,consumeTemplate:!1,useTemplate:!1,struct:{$wrapper:""},dom:{}};return this.settings=$Util.opts(n,t),this._template()._setup(),this}return _createClass(e,[{key:"_template",value:function(){return this.settings.template?this._useTemplate():this._useDefaultTemplate(),$Util.jQuerify(this),this.$wrapper.removeClass("template"),this}},{key:"_useTemplate",value:function(){var e=this.settings.template;if(isString(e))e=$(e);else if(e instanceof $)this.settings.useTemplate||(e=e.clone().removeAttr("id")),this.settings.consumeTemplate&&e.remove();else if(e instanceof $==!1)throw new ReferenceError("Template.useTemplate: first argument must be a string or jquery");var t=this;for(var n in this.settings.struct){var i=this.settings.struct[n];t[n]=e.find(i)}return this.$wrapper=$(e.get(0)),this}},{key:"_useDefaultTemplate",value:function(){return this}},{key:"_setup",value:function(){return this}}]),e}(),TemplateManager=function(e){function t(e){var n;if(_classCallCheck(this,t),!isDefined(e.template))throw new ReferenceError("TemplateManager.constructor: options must have a template property");var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.template=e.template,i.$wrapper=e.$wrapper?e.$wrapper:$('<div class="manager"></div>'),$Util.jQuerify(i),i.$template=isString(e.template)?$(e.template):e.template,i.templates=i.objects,i.current=null,n=i,_possibleConstructorReturn(i,n)}return _inherits(t,e),_createClass(t,[{key:"_add",value:function(){var e=_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_add",this).apply(this,arguments);return this.$wrapper.append(arguments[0].$wrapper||arguments[0]),e}},{key:"_update",value:function(e){var t=this.getId(e),n=this.templates[t];return this.populateTemplate(n,e),this.trigger("update",n),this}},{key:"_delete",value:function(e){return this.templates[e].remove(),_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_delete",this).call(this,e),this}},{key:"_create",value:function(e){var t=this.getId(e);if(!t)throw new Error("TemplateManager._create: templates must have a '"+this.settings.identifier+"' property");var n=this.$template.clone();return n.isFirstUpdate=!0,this.populateTemplate(n,e),this._add(n,t)}},{key:"build",value:function(e){if(!isObject(e)&&this.settings.useObjectNames)throw new Error("TemplateManager.build: to use option useObjectNames, object passed to build() must be an object.");var t=this,n=this.settings.identifier,i=[];for(var r in e){var s=e[r];if(this.settings.useObjectNames&&(s[n]=r),!isDefined(s[n]))return console.error("TemplateManager.build: cannot manage objects with no ids");var a=s[n].toString(),o=t.objects[a];isDefined(o)?t._update(s):t._create(s),i.push(a)}var u=this.getIds(),l=Array.diff(u,i);for(r=0;r<l.length;r++)this._delete(l[r]);return this}},{key:"populateTemplate",value:function(e,t){return e.populateChildren(t),e.isFirstUpdate&&(e.find('[data-update="false"]').attr("data-populate",!1),e.isFirstUpdate=!1),this}},{key:"setCurrent",value:function(e){function t(){i.slideDown()}var n=this,i=this.templates[e];return isDefined(i)?isNull(this.current)?(t(),this.current=i):this.current.slideUp(function(){t(),n.current=i}):console.error("TemplateManager.setCurrent: object not found."),this}}]),t}(Manager);