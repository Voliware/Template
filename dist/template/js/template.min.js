"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function deepCopy(e,t,n){if(null===e||"object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;if("function"==typeof e.clone)return e.clone(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);if(e.nodeType&&"function"==typeof e.cloneNode)return e.cloneNode(!0);void 0===t&&(t=[],n=[]);var r,i=t.length;for(r=0;r<i;r++)if(e===t[r])return n[r];if("[object Array]"==Object.prototype.toString.call(e)){var a=e.slice();for(t.push(e),n.push(a),r=a.length;r--;)a[r]=deepCopy(a[r],t,n);return a}var s=Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;s||(s=e.constructor.prototype);var o=object_create(s);t.push(e),n.push(o);for(var u in e)o[u]=deepCopy(e[u],t,n);return o}var _get2=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){e.extendext=function(){var t,n,r,i,a,s,o=arguments[0]||{},u=1,c=arguments.length,l=!1,f="default";for("boolean"==typeof o&&(l=o,o=arguments[u++]||{}),"string"==typeof o&&(f=o.toLowerCase(),"concat"!==f&&"replace"!==f&&"extend"!==f&&(f="default"),o=arguments[u++]||{}),"object"===("undefined"==typeof o?"undefined":_typeof(o))||e.isFunction(o)||(o={}),u===c&&(o=this,u--);u<c;u++)if(null!==(t=arguments[u]))if(e.isArray(t)&&"default"!==f)switch(s=o&&e.isArray(o)?o:[],f){case"concat":o=s.concat(e.extend(l,[],t));break;case"replace":o=e.extend(l,[],t);break;case"extend":t.forEach(function(t,n){if("object"===("undefined"==typeof t?"undefined":_typeof(t))){var r=e.isArray(t)?[]:{};s[n]=e.extendext(l,f,s[n]||r,t)}else s.indexOf(t)===-1&&s.push(t)}),o=s}else for(n in t)r=o[n],i=t[n],o!==i&&(l&&i&&(e.isPlainObject(i)||(a=e.isArray(i)))?(a?(a=!1,s=r&&e.isArray(r)?r:[]):s=r&&e.isPlainObject(r)?r:{},o[n]=e.extendext(l,f,s,i)):void 0!==i&&(o[n]=i));return o}}(jQuery);var Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"each",value:function(e,t){for(var n in e){var r=e[n];t(n,r)}}}]),e}();"undefined"==typeof isDefined&&(window.isDefined=function(e){return"undefined"!=typeof e}),"undefined"==typeof isNull&&(window.isNull=function(e){return null===e}),"undefined"==typeof isNullOrUndefined&&(window.isNullOrUndefined=function(e){return null===e||"undefined"===e}),"undefined"==typeof isFunction&&(window.isFunction=function(e){return"function"==typeof e}),"undefined"==typeof isString&&(window.isString=function(e){return"string"==typeof e}),"undefined"==typeof isNumber&&(window.isNumber=function(e){return"number"==typeof e}),"undefined"==typeof isObject&&(window.isObject=function(e){return null!==e&&!isArray(e)&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}),"undefined"==typeof isArray&&(window.isArray=function(e){return null!==e&&Array.isArray(e)}),"undefined"==typeof getType&&(window.getType=function(e){return null===e?"[object Null]":Object.prototype.toString.call(e)}),"undefined"==typeof createGuid&&(window.createGuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}),"undefined"==typeof Array.diff&&(Array.diff=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})}),"undefined"==typeof Array.min&&(Array.min=function(e){return Math.min.apply(Math,e)}),"undefined"==typeof Array.max&&(Array.max=function(e){return Math.max.apply(Math,e)}),"undefined"==typeof Object.set&&(Object.set=function(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e});var object_create=Object.create;if("function"!=typeof object_create&&(object_create=function(e){function t(){}return t.prototype=e,new t}),!isDefined($))throw new ReferenceError("util-jquery requires jquery 2.2.2 or greater");"undefined"==typeof isJquery&&(window.isJquery=function(e){return e instanceof $}),function(e){e.fn.hasAttr=function(t){return e(this).is("["+t+"]")},e.fn.populate=function(t){function n(e,t,n){switch(e){case"input":i(t,n);break;case"select":case"textarea":s.val(n);break;case"img":s.attr("src",n);break;case"button":s.prop("disabled",0===n);break;default:s.html(n)}}function r(e){return $Util.populate[e]?$Util.populate[e]:s.hasAttr("data-tag")?$Util.populate[s.attr("data-tag")]:null}function i(e,t){switch(e){case"checkbox":var n=s.data("checked");t.toString()!==n&&"1"!==t.toString()&&t!==!0||s.prop("checked",!0);break;case"radio":var r=t.toString();s.filter('[value="'+r+'"]').prop("checked",!0);break;default:s.val(t)}}var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=e(this);if(s.data("populate")===!1)return this;var o=s.prop("tagName").toLowerCase(),u=s.attr("type"),c=r(o);return c?c.call(this,t):n(o,u,t),s.data("update")===!1&&this.attr("data-populate",!1),a&&s.trigger("change").trigger("input"),this},e.fn.populateChildren=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e(this);return e.each(t,function(e,t){var i=r.find('[name="'+e+'"]'),a=r.find('[data-name="'+e+'"]');i.length>0&&i.data("populate")!==!1&&i.populate(t,n),a.length>0&&a.data("populate")!==!1&&a.populate(t,n)}),this},e.fn.populateAttr=function(t){var n=e(this);return e.each(t,function(e,t){n.attr("i",t)}),this},e.fn.slideToggleState=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t?e(this).slideDown(n,r):e(this).slideUp(n,r),this},e.fn.addToSelect=function(){function t(e){if(e.hasOwnProperty("value")===!1){var t=Object.keys(e)[0],n=e[t];return{value:t,text:n}}return e}var n=e(this);if(!n.is("select"))return this;var r=[];if(arguments.length>1)if(isString(arguments[0])||isNumber(arguments[0])){var i=!!isDefined(arguments[2])&&arguments[2],a={value:arguments[0],text:arguments[1],disabled:i};r=[a]}else isObject(arguments[0])&&(r=arguments);else Array.isArray(arguments[0])?r=arguments[0]:isObject(arguments[0])&&(arguments[0].hasOwnProperty("value")?r=[arguments[0]]:Object.keys(arguments[0]).length>1?e.each(arguments[0],function(e,t){isObject(t)?r.push(t):r.push({value:e,text:t})}):r=[arguments[0]]);for(var s=0;s<r.length;s++){var o=t(r[s]),u='<option value="'+o.value+'"';o.disabled&&(u+=" disabled"),u+=">"+o.text+"</option>",n.append(u)}return this},e.fn.toggleOption=function(){var t=e(this);if(!t.is("select"))return this;var n,r;if(arguments.length>1){r=arguments[0],e.isArray(r)||(r=[r]),n=arguments[1];for(var i=0;i<r.length;i++)t.find('option[value="'+r[i]+'"]').prop("disabled",!n)}else n=arguments[0],t.find("option").prop("disabled",!n);return this}}(jQuery);var $Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"jQuerify",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t.$wrapper)throw new ReferenceError("$Util.jQuerify: $wrapper must be a property of the first argument");Util.each(e.jqueryPrototype,function(e,r){return!(!isDefined(t[r])||n)||("find"===r?(t[r]=function(){var e;return(e=t.$wrapper)[r].apply(e,arguments)},!0):void(t[r]=function(){var e;return(e=t.$wrapper)[r].apply(e,arguments),t}))})}},{key:"opts",value:function(e,t,n){return isDefined(n)?$.extendext(!0,n,e,t):$.extend(!0,e,t)}}]),e}();$Util.jqueryPrototype=Object.getOwnPropertyNames($.prototype),$Util.populate={};var EventSystem=function(){function e(){return _classCallCheck(this,e),this.events={},this}return _createClass(e,[{key:"_createEvent",value:function(e){return this.events[e]={callbacks:[]}}},{key:"_destroy",value:function(e){return isDefined(this.event[e])&&delete this.event[e],this}},{key:"on",value:function(e,t){var n=this.events[e];return isDefined(n)||(n=this._createEvent(e)),n.callbacks.push(t),this}},{key:"off",value:function(e,t){var n=this.events[e];if(isDefined(n)){var r=n.callbacks.indexOf(t);r>-1&&n.callbacks.splice(r,1)}return this}},{key:"offAll",value:function(e){var t=this.events[e];return isDefined(t)&&(t[e].callbacks=[]),this}},{key:"trigger",value:function(){var e=[].shift,t=e.apply(arguments),n=this.events[t];if(!isDefined(n))return this;for(var r=0;r<n.callbacks.length;r++){var i;(i=n.callbacks)[r].apply(i,arguments)}return this}},{key:"emit",value:function(){return this.trigger()}}]),e}();if(!isDefined(EventSystem))throw new ReferenceError("Manager requires EventSystem");var Manager=function(e){function t(e){var n;_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i={identifier:"id",useObjectNames:!1,max:0};return r.settings=Object.assign(i,e),r.objects={},r.count=0,r._cachedData={},r._processedData={},r.serializedObjects=[],r.requiresNewSerialize=!1,n=r,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"_exists",value:function(){var e=arguments[0];return isString(e)||isNumber(e)?isDefined(this.objects[e]):isDefined(this.objects[e[this.settings.identifier]])}},{key:"_get",value:function(){var e=arguments[0],t=null,n=this.settings.identifier;return isString(e)||isNumber(e)?(String(e),this.objects[e]&&(t=this.objects[e])):this.objects[e[n]]&&(t=this.objects[e[n]]),t}},{key:"_add",value:function(e,t){function n(){r.requiresNewSerialize=!0,r.trigger("add",e),r.count++,e._count=r.count}var r=this,i=this.settings.identifier;return isDefined(t)?(String(t),e[i]=t,this.objects[t]=e,n()):isNullOrUndefined(e[i])?console.warn("Manager._add: cannot add an object with no identifier"):(this.objects[e[i]]=e,n()),e}},{key:"_update",value:function(e,t){function n(){r.requiresNewSerialize=!0,r.trigger("update",e),r.count++,e._count=r.count}var r=this,i=this.settings.identifier;return isDefined(t)?(String(t),this.objects[t]=e,n()):isNullOrUndefined(e[i])?console.warn("Manager._update: cannot update an object with no identifier"):(this.objects[e[i]]=e,n()),e}},{key:"_delete",value:function(){var e=(arguments[0],null),t=this.settings.identifier;if(e=this._get.apply(this,arguments)){var n=e[t];this.trigger("delete",n),delete this.objects[n],this.requiresNewSerialize=!0,this.count>0&&this.count--}else console.error("Manager._delete: cannot delete an object with no identifier");return this}},{key:"_empty",value:function(){for(var e in this.objects)delete this.objects[e];return this}},{key:"_cacheData",value:function(e){return this._cachedData=deepCopy(e),this}},{key:"_processData",value:function(e){return this._processedData=deepCopy(e),this}},{key:"getIds",value:function(){var e=[];for(var t in this.objects){var n=this.getId(this.objects[t]);e.push(n)}return e}},{key:"getId",value:function(e){return e[this.settings.identifier].toString()}},{key:"manage",value:function(e){if(this._cacheData(e),this._processData(e),!isObject(this._processedData)&&this.settings.useObjectNames)throw new Error("Manager.manage: to use option useObjectNames, object passed to manage() must be an object.");var t=this,n=this.settings.identifier,r=[];for(var i in this._processedData){var a=this._processedData[i];if(this.settings.useObjectNames&&(a[n]=i),!isDefined(a[n]))return console.error("Manager.manage: cannot manage objects with no ids");var s=a[n].toString(),o=t.objects[s];isDefined(o)?t._update(a):t._add(a),r.push(s)}var u=this.getIds(),c=Array.diff(u,r);for(i=0;i<c.length;i++)this._delete(c[i]);return this}},{key:"exists",value:function(){return this._exists.apply(this,arguments)}},{key:"addObjects",value:function(){var e=arguments.length>1?[].slice.call(arguments).sort():arguments[0];for(var t in e){var n=e[t];this.addObject(n)}return this}},{key:"addObject",value:function(){return this._add.apply(this,arguments)}},{key:"getObject",value:function(){return this._get.apply(this,arguments)}},{key:"updateObject",value:function(){return this._update.apply(this,arguments)}},{key:"deleteObject",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteObjects",value:function(){return this._empty()}},{key:"serializer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.requiresNewSerialize){var n=this;this.serializedObjects=[],$.each(this.objects,function(e,t){t.serializer&&n.serializedObjects.push(t.serializer())}),this.requiresNewSerialize=!1}return t=t>0?t:this.serializedObjects.length,this.serializedObjects.slice(e,t)}}]),t}(EventSystem),Template=function(){function e(t){_classCallCheck(this,e);var n={template:null,consumeTemplate:!1,useTemplate:!1,struct:{$wrapper:""}};return this.settings=$Util.opts(n,t),this._template(),this._cachedData={},this._processedData={},this}return _createClass(e,[{key:"_template",value:function(){return this.settings.template?this._useTemplate():this._useDefaultTemplate(),this.$wrapper.removeClass("template"),$Util.jQuerify(this),this}},{key:"_useTemplate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e=e||this.settings.template,isString(e))e=$(e);else if(e instanceof $)this.settings.useTemplate||(e=e.clone().removeAttr("id")),this.settings.consumeTemplate&&e.remove();else if(e instanceof $==!1)throw new ReferenceError("Template._useTemplate: first argument must be a string or jquery");var t=this;for(var n in this.settings.struct){var r=this.settings.struct[n];t[n]=e.find(r)}return this.$wrapper=$(e.get(0)),this}},{key:"_useDefaultTemplate",value:function(){return this}},{key:"_cacheData",value:function(e){return this._cachedData=$.extend(!0,{},e),this}},{key:"_processData",value:function(e){return this._processedData=$.extend(!0,{},e),this}},{key:"populateChildren",value:function(e){return this._cacheData(e),this._processData(e),this.$wrapper.populateChildren(this._processedData),this}}]),e}(),TemplateManager=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.$wrapper=n.$wrapper?n.$wrapper:$('<div class="manager"></div>'),$Util.jQuerify(r),r.template=isString(n.template)?$(n.template):n.template,r.templates=r.objects,r.current=null,e=r,_possibleConstructorReturn(r,e)}return _inherits(t,e),_createClass(t,[{key:"_add",value:function(){var e=_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_add",this).apply(this,arguments);return this.$wrapper.append(arguments[0].$wrapper||arguments[0]),e}},{key:"_update",value:function(e){var t=this.getId(e),n=this.templates[t];return this._populateTemplate(n,e),this.trigger("update",n),this}},{key:"_delete",value:function(){var e=this._get.apply(this,arguments);return e?(e.remove(),_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_delete",this).call(this,e)):console.error("TemplateManager._delete: could not find template object"),this}},{key:"_create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.template)throw new ReferenceError("TemplateManager._create: no template option was passed to constructor");var n;return this.template.prototype instanceof Template?n=new this.template(t):isJquery(this.template)&&(n=this.template.clone()),this._populateTemplate(n,t),this._add(n,e)}},{key:"_empty",value:function(){for(var e in this.objects)this.objects[e].remove(),delete this.objects[e];return this}},{key:"_populateTemplate",value:function(e,t){return e.populateChildren(t),this}},{key:"manage",value:function(e){return this.build(e)}},{key:"build",value:function(e){if(this._cacheData(e),this._processData(e),!isObject(this._processedData)&&this.settings.useObjectNames)throw new Error("TemplateManager.build: to use option useObjectNames, object passed to build() must be an object.");var t=this,n=this.settings.identifier,r=[];for(var i in this._processedData){var a=this._processedData[i];if(this.settings.useObjectNames&&(a[n]=i),!isDefined(a[n]))return console.error("TemplateManager.build: cannot manage objects with no ids");var s=a[n].toString(),o=t.objects[s];isDefined(o)?t._update(a):t._create(s,a),r.push(s)}var u=this.getIds(),c=Array.diff(u,r);for(i=0;i<c.length;i++)this._delete(c[i]);return this}},{key:"setCurrent",value:function(e){function t(){r.slideDown()}var n=this,r=this.templates[e];return isDefined(r)?isNull(this.current)?(t(),this.current=r):this.current.slideUp(function(){t(),n.current=r}):console.error("TemplateManager.setCurrent: object not found."),this}},{key:"createTemplate",value:function(){return this._create.apply(this,arguments)}},{key:"addTemplates",value:function(){return _get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addObjects",this).apply(this,arguments)}},{key:"addTemplate",value:function(){return this._add.apply(this,arguments)}},{key:"getTemplate",value:function(){return this._get.apply(this,arguments)}},{key:"updateTemplate",value:function(){return this._update.apply(this,arguments)}},{key:"deleteTemplate",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteTemplates",value:function(){return this._empty()}}]),t}(Manager);