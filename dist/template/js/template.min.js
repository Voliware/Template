"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get2=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"each",value:function(e,t){for(var n in e){var r=e[n];t(n,r)}}}]),e}();if("undefined"==typeof isDefined&&(window.isDefined=function(e){return"undefined"!=typeof e}),"undefined"==typeof isNull&&(window.isNull=function(e){return null===e}),"undefined"==typeof isFunction&&(window.isFunction=function(e){return"function"==typeof e}),"undefined"==typeof isString&&(window.isString=function(e){return"string"==typeof e}),"undefined"==typeof isNumber&&(window.isNumber=function(e){return"number"==typeof e}),"undefined"==typeof isObject&&(window.isObject=function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))}),"undefined"==typeof getType&&(window.getType=function(e){return null===e?"[object Null]":Object.prototype.toString.call(e)}),"undefined"==typeof Array.diff&&(Array.diff=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})}),"undefined"==typeof Array.min&&(Array.min=function(e){return Math.min.apply(Math,e)}),"undefined"==typeof Array.max&&(Array.max=function(e){return Math.max.apply(Math,e)}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),!isDefined($))throw new ReferenceError("util-jquery requires jquery 2.2.2 or greater");var $Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"jQuerify",value:function(t){if(!t.$wrapper)throw new ReferenceError("$Util.jQuerify: $wrapper must be a property of the first argument");Util.each(e.jqueryPrototype,function(e,n){t[n]=function(){var e;return(e=t.$wrapper)[n].apply(e,arguments),t}})}},{key:"opts",value:function(e,t){return $.extend(!0,e,t)}}]),e}();$Util.jqueryPrototype=Object.getOwnPropertyNames($.prototype),$Util.populate={},function(e){e.fn.addToSelect=function(){var t={};arguments.length>1?t[arguments[0]]=arguments[1]:t=arguments[0];var n=e(this);return n.is("select")&&Util.each(t,function(e,t){var r='<option value="'+e+'">'+t+"</option>";n.append(r)}),this},e.fn.hasAttr=function(t){return e(this).is("["+t+"]")},e.fn.populate=function(t){function n(e,t,n){switch(e){case"input":i(t,n);break;case"select":case"textarea":s.val(n);break;case"img":s.attr("src",n);break;case"button":s.prop("disabled",0===n);break;default:s.html(n)}}function r(e){return $Util.populate[e]?$Util.populate[e]:s.hasAttr("data-tag")?$Util.populate[s.attr("data-tag")]:null}function i(e,t){switch(e){case"checkbox":var n=s.data("checked");t.toString()!==n&&"1"!==t.toString()&&t!==!0||s.prop("checked",!0);break;case"radio":t===s.attr("value")&&s.prop("checked",!0);break;default:s.val(t)}}var s=e(this),a=s.prop("tagName").toLowerCase(),o=s.attr("type"),u=r(a);return u?u.call(this,t):n(a,o,t),this},e.fn.populateChildren=function(t){var n=e(this);return Util.each(t,function(e,t){var r=n.find('[name="'+e+'"]');0===r.length&&(r=n.find('[data-name="'+e+'"]')),r.length>0&&r.data("populate")!==!1&&r.populate(t)}),this},e.fn.slideToggleState=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t?e(this).slideDown(n,r):e(this).slideUp(n,r),this},e.fn.toggleOption=function(){var t=e(this);if(!t.is("select"))return this;var n,r;if(arguments.length>1){r=arguments[0],e.isArray(r)||(r=[r]),n=arguments[1];for(var i=0;i<r.length;i++)t.find('option[value="'+r[i]+'"]').prop("disabled",!n)}else n=arguments[0],t.find("option").prop("disabled",!n);return this}}(jQuery);var EventSystem=function(){function e(){return _classCallCheck(this,e),this.events={},this}return _createClass(e,[{key:"_create",value:function(e){return this.events[e]={callbacks:[]}}},{key:"_destroy",value:function(e){return isDefined(this.event[e])&&delete this.event[e],this}},{key:"on",value:function(e,t){var n=this.events[e];return isDefined(n)||(n=this._create(e)),n.callbacks.push(t),this}},{key:"off",value:function(e,t){var n=this.events[e];if(isDefined(n)){var r=n.callbacks.indexOf(t);r>-1&&n.callbacks.splice(r,1)}return this}},{key:"offAll",value:function(e){var t=this.events[e];return isDefined(t)&&(t[e].callbacks=[]),this}},{key:"trigger",value:function(){var e=[].shift,t=e.apply(arguments),n=this.events[t];if(!isDefined(n))return this;for(var r=0;r<n.callbacks.length;r++){var i;(i=n.callbacks)[r].apply(i,arguments)}return this}},{key:"emit",value:function(){return this.trigger()}}]),e}();if(!isDefined(EventSystem))throw new ReferenceError("Manager requires EventSystem");var Manager=function(e){function t(e){var n;_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i={identifier:"id",useObjectNames:!1};return r.settings=Object.assign(i,e),r.objects={},r._objectsArray=[],r.count=0,r._cachedData={},n=r,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"_exists",value:function(){var e=arguments[0];return isString(e)||isNumber(e)?isDefined(this.objects[e]):isDefined(this.objects[e[this.settings.identifier]])}},{key:"_get",value:function(){var e=arguments[0];return isString(e)||isNumber(e)?this.objects[e]:this.objects[e[this.settings.identifier]]}},{key:"_add",value:function(e,t){return this.trigger("add",e),this.count++,this._objectsArray[this.count]=e,isDefined(t)?(e[this.settings.identifier]=t,this.objects[t]=e):this.objects[e[this.settings.identifier]]=e}},{key:"_update",value:function(e,t){return this.trigger("update",e),t?this.objects[t]=e:this.objects[e[this.settings.identifier]]=e}},{key:"_delete",value:function(){var e=arguments[0];if(isString(e)||isNumber(e))String(e),this.objects[e]&&delete this.objects[e];else{if(!this.objects[e[this.settings.identifier]])return this;delete this.objects[e[this.settings.identifier]]}return this.count>0&&this.count--,this.trigger("delete",arguments[0]),this}},{key:"_empty",value:function(){for(var e in this.objects)delete this.objects[e];return this}},{key:"_cacheData",value:function(e){return this._cachedData=Object.create(e),this}},{key:"_processData",value:function(e){return e}},{key:"getIds",value:function(){var e=[];for(var t in this.objects)e.push(t);return e}},{key:"getId",value:function(e){return e[this.settings.identifier]}},{key:"manage",value:function(e){if(e=this._processData(e),!isObject(e)&&this.settings.useObjectNames)throw new Error("Manager.manage: to use option useObjectNames, object passed to manage() must be an object.");var t=this,n=this.settings.identifier,r=[];for(var i in e){var s=e[i];if(this.settings.useObjectNames&&(s[n]=i),!isDefined(s[n]))return console.error("Manager.manage: cannot manage objects with no ids");var a=s[n].toString(),o=t.objects[a];isDefined(o)?t._update(s):t._add(s),r.push(a)}var u=this.getIds(),l=Array.diff(u,r);for(i=0;i<l.length;i++)this._delete(l[i]);return this}},{key:"exists",value:function(){return this._exists.apply(this,arguments)}},{key:"addObjects",value:function(){var e=arguments.length>1?[].slice.call(arguments).sort():arguments[0];for(var t in e){var n=e[t];this.addObject(n)}return this}},{key:"addObject",value:function(){return this._add.apply(this,arguments)}},{key:"getObject",value:function(){return this._get.apply(this,arguments)}},{key:"updateObject",value:function(){return this._update.apply(this,arguments)}},{key:"deleteObject",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteObjects",value:function(){return this._empty()}},{key:"serializer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];for(e;e<t&&!(e>=t);e++){var r=this._objectsArray[i];r.toObject&&n.push(r.toObject()),e++}return n}}]),t}(EventSystem),Template=function(){function e(t){_classCallCheck(this,e);var n={template:null,consumeTemplate:!1,useTemplate:!1,struct:{$wrapper:""},dom:{}};return this.settings=$Util.opts(n,t),this._template()._setup(),this}return _createClass(e,[{key:"_template",value:function(){return this.settings.template?this._useTemplate():this._useDefaultTemplate(),$Util.jQuerify(this),this}},{key:"_useTemplate",value:function(){var e=this.settings.template;if(isString(e))e=$(e);else if(e instanceof $)this.settings.useTemplate||(e=e.clone().removeAttr("id")),this.settings.consumeTemplate&&e.remove();else if(e instanceof $==!1)throw new ReferenceError("Template.useTemplate: first argument must be a string or jquery");var t=this;for(var n in this.settings.struct){var r=this.settings.struct[n];t[n]=e.find(r)}return this.$wrapper=$(e.get(0)),this}},{key:"_useDefaultTemplate",value:function(){return this}},{key:"_setup",value:function(){return this}}]),e}(),TemplateManager=function(e){function t(e){var n;if(_classCallCheck(this,t),!isDefined(e.template))throw new ReferenceError("TemplateManager.constructor: options must have a template property");var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.template=e.template,r.$wrapper=e.$wrapper?e.$wrapper:$('<div class="manager"></div>'),$Util.jQuerify(r),r.$template=isString(e.template)?$(e.template):e.template,r.templates=r.objects,r.current=null,n=r,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"_add",value:function(){var e=_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_add",this).apply(this,arguments);return this.$wrapper.append(arguments[0].$wrapper||arguments[0]),e}},{key:"_update",value:function(e){var t=this.getId(e),n=this.templates[t];return this.populateTemplate(n,e),this.trigger("update",n),this}},{key:"_delete",value:function(e){return this.templates[e].remove(),_get2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_delete",this).call(this,e),this}},{key:"_create",value:function(e){var t=this.getId(e);if(!t)throw new Error("TemplateManager._add: templates must have a "+this.settings.identifier+" property");var n=this.$template.clone();return n.isFirstUpdate=!0,this.populateTemplate(n,e),this._add(n,t)}},{key:"build",value:function(e){if(!isObject(e)&&this.settings.useObjectNames)throw new Error("TemplateManager.build: to use option useObjectNames, object passed to build() must be an object.");var t=this,n=this.settings.identifier,r=[];for(var i in e){var s=e[i];if(this.settings.useObjectNames&&(s[n]=i),!isDefined(s[n]))return console.error("TemplateManager.build: cannot manage objects with no ids");var a=s[n].toString(),o=t.objects[a];isDefined(o)?t._update(s):t._create(s),r.push(a)}var u=this.getIds(),l=Array.diff(u,r);for(i=0;i<l.length;i++)this._delete(l[i]);return this}},{key:"populateTemplate",value:function(e,t){return e.populateChildren(t),e.isFirstUpdate&&(e.find('[data-update="false"]').attr("data-populate",!1),e.isFirstUpdate=!1),this}},{key:"setCurrent",value:function(e){function t(){r.slideDown()}var n=this,r=this.templates[e];return isDefined(r)?isNull(this.current)?(t(),this.current=r):this.current.slideUp(function(){t(),n.current=r}):console.error("TemplateManager.setCurrent: object not found."),this}}]),t}(Manager);